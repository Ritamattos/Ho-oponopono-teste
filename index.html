<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ho'oponopono - Jornada Gal√°ctica</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üôè</text></svg>">
    <meta name="description" content="Ho'oponopono - Jornada de Cura e Transforma√ß√£o. Pratique a antiga t√©cnica havaiana de limpeza e perd√£o.">
    <meta name="keywords" content="hooponopono, ho'oponopono, medita√ß√£o, cura, transforma√ß√£o, hava√≠, perd√£o">
    <meta name="author" content="Rita Mattos">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Ho'oponopono - Jornada de Cura e Transforma√ß√£o">
    <meta property="og:description" content="Pratique a antiga t√©cnica havaiana de limpeza e perd√£o">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://via.placeholder.com/1200x630/8b5cf6/ffffff?text=Ho'oponopono">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#8b5cf6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ho'oponopono">
    <link rel="manifest" href="manifest.json">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
            background: #000;
            color: #fff;
            touch-action: manipulation;
        }

        /* Efeito Gal√°xia de Fundo */
        .galaxy-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #1a0033, #0a1f1f);
            overflow: hidden;
            z-index: -1;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, #fff, transparent),
                radial-gradient(2px 2px at 40px 70px, #fff, transparent),
                radial-gradient(1px 1px at 50px 50px, #fff, transparent);
            background-repeat: repeat;
            background-size: 200px 200px;
            animation: twinkle 10s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .nebula {
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(138, 43, 226, 0.3) 0%, transparent 70%);
            filter: blur(40px);
            animation: float 20s infinite ease-in-out;
        }

        .nebula:nth-child(2) {
            top: 20%;
            right: 10%;
            background: radial-gradient(circle, rgba(0, 255, 127, 0.2) 0%, transparent 70%);
            animation-delay: -5s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(-20px, 20px) scale(0.9); }
        }

        /* Container Principal */
        .app-container {
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* Tela Inicial */
        .splash-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .logo {
            font-size: clamp(60px, 15vw, 80px);
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.3s ease;
            user-select: none;
        }

        .logo:hover {
            transform: scale(1.1);
        }

        .splash-screen h1 {
            font-size: clamp(2em, 8vw, 3.5em);
            margin-bottom: 10px;
            color: #e9d5ff;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        .subtitle {
            font-size: clamp(1em, 4vw, 1.2em);
            color: #c4b5fd;
            margin-bottom: 30px;
        }

        .name-input {
            width: 100%;
            max-width: 300px;
            padding: 15px 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 25px;
            background: rgba(30, 0, 60, 0.3);
            backdrop-filter: blur(10px);
            color: white;
            font-size: clamp(1em, 4vw, 1.1em);
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
        }

        .name-input:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }

        .name-input::placeholder {
            color: #a78bfa;
        }

        .btn {
            background: linear-gradient(135deg, #8b5cf6, #10b981);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: clamp(1em, 4vw, 1.1em);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        /* Tela Principal */
        .main-screen {
            display: none;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(30, 0, 60, 0.3);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(139, 92, 246, 0.3);
        }

        .content-section {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .content-section.active {
            display: block;
        }

        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .module-card {
            background: rgba(30, 0, 60, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(139, 92, 246, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
            border-color: #8b5cf6;
        }

        .module-number {
            position: absolute;
            top: 10px;
            right: 15px;
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #8b5cf6, #10b981);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            background: rgba(30, 0, 60, 0.9);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(139, 92, 246, 0.3);
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #c4b5fd;
        }

        .nav-item.active {
            color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }

        .nav-item span:first-child {
            font-size: clamp(18px, 5vw, 24px);
            margin-bottom: 5px;
        }

        .nav-item span:last-child {
            font-size: clamp(10px, 3vw, 12px);
        }

        /* Book Reader */
        .book-reader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            padding: 20px;
        }

        .book-container {
            max-width: 1000px;
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .book-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            background: #ef4444;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }

        .flipbook-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .book {
            width: 100%;
            max-width: 800px;
            min-height: 500px;
            position: relative;
        }

        .page-spread {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            min-height: 500px;
        }

        .page-spread.current {
            display: grid;
        }

        @media (max-width: 768px) {
            .page-spread {
                grid-template-columns: 1fr;
                gap: 0;
            }
        }

        .page-left, .page-right {
            padding: 40px 30px;
            background: white;
            color: #333;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .page-content {
            flex: 1;
            line-height: 1.6;
        }

        .page-content h2 {
            color: #8b5cf6;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .page-number {
            position: absolute;
            bottom: 20px;
            right: 20px;
            font-size: 0.9em;
            color: #666;
        }

        .book-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding: 0 20px;
        }

        .nav-btn {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .nav-btn:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .nav-btn:not(:disabled):hover {
            background: #7c3aed;
            transform: translateY(-2px);
        }

        .page-indicator {
            color: #c4b5fd;
            font-size: 1em;
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 3000;
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .toast.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .toast.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .modules-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 15px;
            }
            
            .content-section {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
    // SUAS CONFIGURA√á√ïES DO FIREBASE
    const firebaseConfig = {
        apiKey: "AIzaSyCMHT91AuBTvt-5qRUV59DyJvSW_hoKT9I",
        authDomain: "app-ho-ponopono.firebaseapp.com",
        databaseURL: "https://app-ho-ponopono-default-rtdb.firebaseio.com",
        projectId: "app-ho-ponopono",
        storageBucket: "app-ho-ponopono.firebasestorage.app",
        messagingSenderId: "765685821282",
        appId: "1:765685821282:web:bee178199de7d2022a063b"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    console.log("üî• Firebase conectado com sucesso!");
    </script>

    <!-- Efeito Gal√°xia de Fundo -->
    <div class="galaxy-bg">
        <div class="stars"></div>
        <div class="nebula"></div>
        <div class="nebula"></div>
    </div>
<div class="app-container">
        <!-- Tela Inicial -->
        <div class="splash-screen" id="splash">
            <div class="logo" id="logoSecret" onclick="contarCliquesSecretos()">üôè</div>
            <h1>Ho'oponopono</h1>
            <p class="subtitle">Jornada de Cura e Transforma√ß√£o</p>
            <input type="text" class="name-input" id="name" placeholder="Digite seu nome" maxlength="30">
            <button class="btn" onclick="entrarApp()" id="btnIniciarJornada">Iniciar Jornada</button>
            
            <!-- Acesso Admin (totalmente escondido) -->
            <div id="botaoAdminSecreto" style="display: none; position: absolute; bottom: 10px; right: 10px;">
                <button style="background: rgba(139, 92, 246, 0.8); border: none; color: white; padding: 8px 12px; border-radius: 5px; font-size: 0.9em; cursor: pointer; animation: pulse 2s infinite;" onclick="abrirLoginAdmin()">üîê Acesso Admin</button>
            </div>
        </div>

        <!-- Tela Principal -->
        <div class="main-screen" id="main">
            <!-- Header -->
            <div class="header">
                <div class="header-left">
                    <div style="font-weight: bold; font-size: clamp(1.1em, 4vw, 1.2em);" id="welcome">Bem-vindo</div>
                    <div style="color: #c4b5fd; font-size: clamp(0.9em, 3vw, 1em);" id="userLevel">N√≠vel: Iniciante</div>
                </div>
                <div class="header-right">
                    <div style="color: #c4b5fd; font-size: clamp(0.9em, 3vw, 1em);">Progresso: 35%</div>
                    <div id="adminPanel" style="display: none; margin-top: 5px;">
                        <button style="background: #8b5cf6; color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: clamp(0.7em, 2.5vw, 0.8em); cursor: pointer;" onclick="abrirPainelAdmin()">üìã Painel Admin</button>
                    </div>
                </div>
            </div>

            <!-- Conte√∫do Principal - In√≠cio -->
            <div id="homeContent" class="content-section active">
                <h2 style="margin-bottom: 20px; color: #e9d5ff; font-size: clamp(1.5em, 5vw, 2em);">üìö M√≥dulos de Aprendizado</h2>
                <div class="modules-grid" id="modulesContainer">
                    <!-- M√≥dulos ser√£o carregados dinamicamente -->
                </div>
            </div>

            <!-- Conte√∫do - Di√°rio -->
            <div id="diaryContent" class="content-section">
                <h2 style="margin-bottom: 20px; color: #e9d5ff; font-size: clamp(1.5em, 5vw, 2em);">üìñ Meu Di√°rio Ho'oponopono</h2>
                <div style="background: rgba(30, 0, 60, 0.3); backdrop-filter: blur(10px); border-radius: 20px; padding: clamp(20px, 5vw, 30px); border: 1px solid rgba(139, 92, 246, 0.3); margin-bottom: 20px;">
                    <h3 style="color: #a78bfa; margin-bottom: 15px; font-size: clamp(1.2em, 4vw, 1.5em);">Hoje</h3>
                    <textarea id="diaryText" style="width: 100%; min-height: 150px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 10px; padding: 15px; color: white; font-size: clamp(1em, 3vw, 1.1em); resize: vertical;" placeholder="Como foi sua pr√°tica hoje? O que voc√™ limpou?"></textarea>
                    <button class="btn" style="margin-top: 15px;" onclick="salvarDiario()">Salvar Entrada</button>
                </div>
                
                <h3 style="color: #e9d5ff; margin-bottom: 15px; font-size: clamp(1.2em, 4vw, 1.5em);">Entradas Anteriores</h3>
                <div id="entradas" style="background: rgba(30, 0, 60, 0.3); backdrop-filter: blur(10px); border-radius: 20px; padding: 20px; border: 1px solid rgba(139, 92, 246, 0.3);">
                    <p style="color: #c4b5fd; text-align: center;">Suas entradas aparecer√£o aqui</p>
                </div>
            </div>

            <!-- Conte√∫do - √Åudios -->
            <div id="audioContent" class="content-section">
                <h2 style="margin-bottom: 20px; color: #e9d5ff; font-size: clamp(1.5em, 5vw, 2em);">üéµ Biblioteca de √Åudios</h2>
                
                <div class="modules-grid" id="audioGrid">
                    <!-- √Åudios ser√£o adicionados dinamicamente aqui -->
                    <div id="mensagemSemAudios" style="grid-column: 1/-1; text-align: center; padding: 40px; background: rgba(30, 0, 60, 0.3); backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid rgba(139, 92, 246, 0.3);">
                        <div style="font-size: clamp(40px, 10vw, 48px); margin-bottom: 20px;">üéµ</div>
                        <h3 style="color: #a78bfa; margin-bottom: 10px; font-size: clamp(1.2em, 4vw, 1.5em);">Nenhum √°udio adicionado ainda</h3>
                        <p style="color: #c4b5fd; font-size: clamp(1em, 3vw, 1.1em);">Use o painel admin para adicionar seus √°udios de Ho'oponopono</p>
                    </div>
                </div>
            </div>

            <!-- Conte√∫do - Comunidade -->
            <div id="communityContent" class="content-section">
                <h2 style="margin-bottom: 20px; color: #e9d5ff; font-size: clamp(1.5em, 5vw, 2em);">üë• Comunidade Ho'oponopono</h2>
                <div style="background: rgba(30, 0, 60, 0.3); backdrop-filter: blur(10px); border-radius: 20px; padding: clamp(20px, 5vw, 30px); border: 1px solid rgba(139, 92, 246, 0.3); margin-bottom: 20px;">
                    <h3 style="color: #a78bfa; margin-bottom: 15px; font-size: clamp(1.2em, 4vw, 1.5em);">Compartilhe sua Experi√™ncia</h3>
                    <textarea id="postText" style="width: 100%; min-height: 100px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 10px; padding: 15px; color: white; font-size: clamp(1em, 3vw, 1.1em);" placeholder="Compartilhe sua jornada com outros praticantes..."></textarea>
                    
                    <!-- Upload de imagem -->
                    <div style="margin-top: 15px;">
                        <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="mostrarPreview(event)">
                        <label for="imageUpload" style="cursor: pointer; color: #a78bfa; text-decoration: underline; margin-right: 15px; font-size: clamp(1em, 3vw, 1.1em);">
                            üì∑ Adicionar imagem
                        </label>
                        <div id="imagePreview" style="margin-top: 10px; display: none;">
                            <img id="previewImg" style="max-width: 200px; max-height: 200px; border-radius: 10px; border: 2px solid rgba(139, 92, 246, 0.3);">
                            <button class="delete-btn" onclick="removerImagem()" style="margin-left: 10px;">‚úï Remover</button>
                        </div>
                    </div>
                    
                    <button class="btn" style="margin-top: 15px;" onclick="publicarPost()">Publicar</button>
                </div>
                
                <h3 style="color: #e9d5ff; margin-bottom: 15px; font-size: clamp(1.2em, 4vw, 1.5em);">Posts Recentes</h3>
                <div id="posts">
                    <div style="background: rgba(30, 0, 60, 0.3); backdrop-filter: blur(10px); border-radius: 20px; padding: 20px; border: 1px solid rgba(139, 92, 246, 0.3); margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <div style="width: 40px; height: 40px; background: #8b5cf6; border-radius: 50%; display: flex; align-items: center; justify-content: center;">M</div>
                            <div style="flex: 1;">
                                <div style="font-weight: bold;">Maria Silva</div>
                                <div style="color: #c4b5fd; font-size: 0.9em;">h√° 2 horas</div>
                            </div>
                        </div>
                        <p style="line-height: 1.6; margin-bottom: 15px;">Hoje pratiquei Ho'oponopono no trabalho e senti uma paz incr√≠vel! Gratid√£o üôè</p>
                        
                        <!-- Se√ß√£o de coment√°rios -->
                        <div style="border-top: 1px solid rgba(139, 92, 246, 0.2); padding-top: 15px;">
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <input type="text" placeholder="Adicione um coment√°rio..." style="flex: 1; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 15px; padding: 8px 15px; color: white; font-size: clamp(0.8em, 2.5vw, 0.9em);" onkeypress="if(event.key==='Enter') comentar(this, 'default')">
                                <button style="background: #8b5cf6; color: white; border: none; padding: 8px 15px; border-radius: 15px; cursor: pointer; font-size: clamp(0.8em, 2.5vw, 0.9em); min-height: 40px;" onclick="comentar(this.previousElementSibling, 'default')">üí¨</button>
                            </div>
                            <div id="comentarios-default">
                                <!-- Coment√°rios aparecer√£o aqui -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Navigation -->
            <div class="bottom-nav">
                <div class="nav-item active" onclick="irPara('home')">
                    <span>üè†</span>
                    <span>In√≠cio</span>
                </div>
                <div class="nav-item" onclick="irPara('diary')">
                    <span>üìñ</span>
                    <span>Di√°rio</span>
                </div>
                <div class="nav-item" onclick="irPara('audio')">
                    <span>üéµ</span>
                    <span>√Åudios</span>
                </div>
                <div class="nav-item" onclick="irPara('community')">
                    <span>üë•</span>
                    <span>Comunidade</span>
                </div>
            </div>
        </div>
<!-- Modal Login Admin -->
        <div id="loginAdmin" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 2000; align-items: center; justify-content: center;">
            <div style="background: rgba(30, 0, 60, 0.9); padding: clamp(20px, 5vw, 40px); border-radius: 20px; border: 1px solid rgba(139, 92, 246, 0.3); text-align: center; max-width: 90vw; width: 400px;">
                <h3 style="color: #a78bfa; margin-bottom: 20px; font-size: clamp(1.2em, 4vw, 1.5em);">Acesso Administrativo</h3>
                <input type="text" id="adminUser" placeholder="Usu√°rio" style="width: 100%; margin-bottom: 10px; padding: clamp(8px, 2vw, 10px); border-radius: 5px; border: 1px solid #666; background: rgba(0,0,0,0.3); color: white; font-size: clamp(14px, 3vw, 16px);">
                <br>
                <input type="password" id="adminPass" placeholder="Senha" style="width: 100%; margin-bottom: 20px; padding: clamp(8px, 2vw, 10px); border-radius: 5px; border: 1px solid #666; background: rgba(0,0,0,0.3); color: white; font-size: clamp(14px, 3vw, 16px);">
                <br>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button style="background: #8b5cf6; color: white; border: none; padding: clamp(8px, 2vw, 10px) clamp(16px, 4vw, 20px); border-radius: 5px; cursor: pointer; font-size: clamp(14px, 3vw, 16px); min-height: 44px;" onclick="fazerLoginAdmin()">Entrar</button>
                    <button style="background: #666; color: white; border: none; padding: clamp(8px, 2vw, 10px) clamp(16px, 4vw, 20px); border-radius: 5px; cursor: pointer; font-size: clamp(14px, 3vw, 16px); min-height: 44px;" onclick="fecharLoginAdmin()">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal Painel Admin -->
        <div id="painelAdmin" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 2000; padding: clamp(10px, 3vw, 20px); overflow-y: auto;">
            <div style="max-width: min(800px, 95vw); margin: 0 auto; background: rgba(30, 0, 60, 0.9); padding: clamp(15px, 4vw, 30px); border-radius: 20px; border: 1px solid rgba(139, 92, 246, 0.3);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: clamp(20px, 5vw, 30px); flex-wrap: wrap; gap: 10px;">
                    <h2 style="color: #a78bfa; font-size: clamp(1.5em, 5vw, 2em);">üìã Painel Administrativo</h2>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button style="background: #10b981; color: white; border: none; padding: clamp(6px, 2vw, 8px) clamp(12px, 3vw, 15px); border-radius: 5px; cursor: pointer; font-size: clamp(12px, 3vw, 14px); min-height: 40px;" onclick="logoutAdminSimples()" id="btnSairAdmin">üë§ Sair Admin</button>
                        <button style="background: #ef4444; color: white; border: none; padding: clamp(6px, 2vw, 8px) clamp(12px, 3vw, 15px); border-radius: 5px; cursor: pointer; font-size: clamp(12px, 3vw, 14px); min-height: 40px;" onclick="fecharPainelAdmin()">‚úï Fechar</button>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr; gap: clamp(15px, 4vw, 20px);">
                    <!-- Editor de M√≥dulos -->
                    <div style="background: rgba(0,0,0,0.2); padding: clamp(15px, 4vw, 20px); border-radius: 10px;">
                        <h3 style="color: #10b981; margin-bottom: 15px; font-size: clamp(1.2em, 4vw, 1.4em);">üìù Editor de M√≥dulos</h3>
                        
                        <!-- Seletor de M√≥dulo -->
                        <select id="seletorModulo" onchange="carregarModuloEditor()" style="width: 100%; margin-bottom: 15px; padding: clamp(6px, 2vw, 8px); border-radius: 5px; border: 1px solid #666; background: rgba(0,0,0,0.3); color: white; font-size: clamp(14px, 3vw, 16px);">
                            <option value="">Selecione um m√≥dulo para editar</option>
                        </select>
                        
                        <!-- Ou criar novo -->
                        <div style="text-align: center; margin: 15px 0; color: #c4b5fd; font-size: clamp(1em, 3vw, 1.1em);">ou</div>
                        
                        <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                            <input type="text" id="novoModuloTitulo" placeholder="T√≠tulo do novo m√≥dulo" style="flex: 1; min-width: 200px; padding: clamp(6px, 2vw, 8px); border-radius: 5px; border: 1px solid #666; background: rgba(0,0,0,0.3); color: white; font-size: clamp(14px, 3vw, 16px);">
                            <input type="text" id="novoModuloDescricao" placeholder="Descri√ß√£o" style="flex: 1; min-width: 200px; padding: clamp(6px, 2vw, 8px); border-radius: 5px; border: 1px solid #666; background: rgba(0,0,0,0.3); color: white; font-size: clamp(14px, 3vw, 16px);">
                            <button style="background: #10b981; color: white; border: none; padding: clamp(6px, 2vw, 8px) clamp(12px, 3vw, 15px); border-radius: 5px; cursor: pointer; font-size: clamp(12px, 3vw, 14px); min-height: 40px; white-space: nowrap;" onclick="criarNovoModulo()">Criar Novo</button>
                        </div>
                    </div>
                    
                    <!-- Editor de P√°ginas -->
                    <div id="editorPaginas" style="background: rgba(0,0,0,0.2); padding: clamp(15px, 4vw, 20px); border-radius: 10px; display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;">
                            <h3 style="color: #8b5cf6; font-size: clamp(1.2em, 4vw, 1.4em);">üìÑ Editor de P√°ginas</h3>
                            <button style="background: #10b981; color: white; border: none; padding: clamp(6px, 2vw, 8px) clamp(12px, 3vw, 15px); border-radius: 5px; cursor: pointer; font-size: clamp(12px, 3vw, 14px); min-height: 40px;" onclick="adicionarNovaPagina()">+ Nova P√°gina</button>
                        </div>
                        
                        <!-- Lista de p√°ginas -->
                        <div id="listaPaginas" style="margin-bottom: 20px;"></div>
                        
                        <!-- Editor da p√°gina atual -->
                        <div id="editorPaginaAtual" style="display: none;">
                            <h4 style="color: #a78bfa; margin-bottom: 10px; font-size: clamp(1.1em, 3.5vw, 1.3em);">Editando P√°gina <span id="numeroPaginaAtual"></span></h4>
                            
                            <!-- T√≠tulo da p√°gina -->
                            <input type="text" id="tituloPagina" placeholder="T√≠tulo da p√°gina" style="width: 100%; margin-bottom: 10px; padding: clamp(6px, 2vw, 8px); border-radius: 5px; border: 1px solid #666; background: rgba(0,0,0,0.3); color: white; font-size: clamp(14px, 3vw, 16px);">
                            
                            <!-- Editor de conte√∫do -->
                            <div style="margin-bottom: 15px;">
                                <div style="display: flex; gap: clamp(5px, 2vw, 10px); margin-bottom: 10px; flex-wrap: wrap;">
                                    <button style="background: #8b5cf6; color: white; border: none; padding: clamp(4px, 1vw, 5px) clamp(8px, 2vw, 10px); border-radius: 3px; cursor: pointer; font-size: clamp(12px, 2.5vw, 14px); min-height: 36px;" onclick="adicionarElemento('titulo')">+ T√≠tulo</button>
                                    <button style="background: #10b981; color: white; border: none; padding: clamp(4px, 1vw, 5px) clamp(8px, 2vw, 10px); border-radius: 3px; cursor: pointer; font-size: clamp(12px, 2.5vw, 14px); min-height: 36px;" onclick="adicionarElemento('subtitulo')">+ Subt√≠tulo</button>
                                    <button style="background: #f59e0b; color: white; border: none; padding: clamp(4px, 1vw, 5px) clamp(8px, 2vw, 10px); border-radius: 3px; cursor: pointer; font-size: clamp(12px, 2.5vw, 14px); min-height: 36px;" onclick="adicionarElemento('texto')">+ Texto</button>
                                    <button style="background: #ef4444; color: white; border: none; padding: clamp(4px, 1vw, 5px) clamp(8px, 2vw, 10px); border-radius: 3px; cursor: pointer; font-size: clamp(12px, 2.5vw, 14px); min-height: 36px;" onclick="adicionarElemento('imagem')">+ Imagem</button>
                                    <button style="background: #a78bfa; color: white; border: none; padding: clamp(4px, 1vw, 5px) clamp(8px, 2vw, 10px); border-radius: 3px; cursor: pointer; font-size: clamp(12px, 2.5vw, 14px); min-height: 36px;" onclick="adicionarElemento('frases4')">üå∫ 4 Frases</button>
                                </div>
                                
                                <!-- √Årea de conte√∫do -->
                                <div id="areaConteudo" style="border: 1px solid #666; border-radius: 5px; padding: 15px; min-height: 200px; background: rgba(0,0,0,0.1);">
                                    <p style="color: #999; text-align: center; font-size: clamp(14px, 3vw, 16px);">Clique nos bot√µes acima para adicionar elementos √† p√°gina</p>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap;">
                                <button style="background: #10b981; color: white; border: none; padding: clamp(6px, 2vw, 8px) clamp(12px, 3vw, 15px); border-radius: 5px; cursor: pointer; font-size: clamp(12px, 3vw, 14px); min-height: 40px;" onclick="salvarPaginaAtual()">üíæ Salvar P√°gina</button>
                                <button style="background: #ef4444; color: white; border: none; padding: clamp(6px, 2vw, 8px) clamp(12px, 3vw, 15px); border-radius: 5px; cursor: pointer; font-size: clamp(12px, 3vw, 14px); min-height: 40px;" onclick="excluirPaginaAtual()">üóëÔ∏è Excluir P√°gina</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Upload de √Åudios -->
                    <div style="background: rgba(0,0,0,0.2); padding: clamp(15px, 4vw, 20px); border-radius: 10px;">
                        <h3 style="color: #f59e0b; margin-bottom: 15px; font-size: clamp(1.2em, 4vw, 1.4em);">üéµ Upload de √Åudios</h3>
                        
                        <!-- Dicas de formato -->
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; padding: clamp(8px, 2vw, 12px); margin-bottom: 15px;">
                            <h4 style="color: #10b981; margin-bottom: 8px; font-size: clamp(12px, 3vw, 14px);">üìã Formatos Recomendados:</h4>
                            <ul style="color: #c4b5fd; font-size: clamp(11px, 2.5vw, 13px); margin-left: 20px;">
                                <li><strong>MP3</strong> - M√°xima compatibilidade (recomendado)</li>
                                <li><strong>WAV</strong> - Alta qualidade</li>
                                <li><strong>OGG</strong> - Boa compress√£o</li>
                                <li><strong>M4A/AAC</strong> - Alternativa moderna</li>
                            </ul>
                            <p style="color: #fbbf24; font-size: clamp(11px, 2.5vw, 13px); margin-top: 8px;">üí° Se tiver problemas, converta para MP3 primeiro!</p>
                        </div>
                        
                        <input type="file" id="uploadAudio" accept="audio/*" style="margin-bottom: 10px; width: 100%; padding: clamp(6px, 2vw, 8px); border-radius: 5px; border: 1px solid #666; background: rgba(0,0,0,0.3); color: white; font-size: clamp(14px, 3vw, 16px);">
                        <input type="text" id="nomeAudio" placeholder="Nome do √°udio (ex: Medita√ß√£o das 4 Frases)" style="width: 100%; margin-bottom: 10px; padding: clamp(6px, 2vw, 8px); border-radius: 5px; border: 1px solid #666; background: rgba(0,0,0,0.3); color: white; font-size: clamp(14px, 3vw, 16px);">
                        <input type="text" id="descricaoAudio" placeholder="Descri√ß√£o (ex: Limpeza Financeira ‚Ä¢ 15 min)" style="width: 100%; margin-bottom: 10px; padding: clamp(6px, 2vw, 8px); border-radius: 5px; border: 1px solid #666; background: rgba(0,0,0,0.3); color: white; font-size: clamp(14px, 3vw, 16px);">
                        <button style="background: #f59e0b; color: white; border: none; padding: clamp(6px, 2vw, 8px) clamp(12px, 3vw, 15px); border-radius: 5px; cursor: pointer; width: 100%; font-size: clamp(14px, 3vw, 16px); min-height: 44px;" onclick="adicionarAudio()" id="btnUploadAudio">üì§ Adicionar √Åudio</button>
                        
                        <!-- Status do upload -->
                        <div id="statusUpload" style="margin-top: 10px; padding: clamp(6px, 2vw, 8px); border-radius: 5px; display: none;">
                            <span id="statusTexto"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Estat√≠sticas -->
                <div style="margin-top: clamp(20px, 5vw, 30px); background: rgba(0,0,0,0.2); padding: clamp(15px, 4vw, 20px); border-radius: 10px;">
                    <h3 style="color: #a78bfa; margin-bottom: 15px; font-size: clamp(1.2em, 4vw, 1.4em);">üìä Estat√≠sticas do App</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: clamp(1.5em, 6vw, 2em); color: #10b981;" id="statModulos">0</div>
                            <div style="color: #c4b5fd; font-size: clamp(12px, 3vw, 14px);">M√≥dulos Ativos</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: clamp(1.5em, 6vw, 2em); color: #8b5cf6;" id="statPaginas">0</div>
                            <div style="color: #c4b5fd; font-size: clamp(12px, 3vw, 14px);">P√°ginas Totais</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: clamp(1.5em, 6vw, 2em); color: #fbbf24;" id="statAudios">0</div>
                            <div style="color: #c4b5fd; font-size: clamp(12px, 3vw, 14px);">√Åudios Dispon√≠veis</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
<!-- Book Reader Modal -->
        <div class="book-reader" id="book">
            <div class="book-container">
                <div class="book-header">
                    <h2 id="bookTitle" style="color: #e9d5ff; font-size: clamp(1.2em, 4vw, 1.5em);">M√≥dulo</h2>
                    <button class="close-btn" onclick="fecharLivro()">‚úï</button>
                </div>
                
                <div class="flipbook-container">
                    <div class="book" id="flipbook">
                        <!-- P√°ginas ser√£o inseridas dinamicamente -->
                    </div>
                </div>
                
                <div class="book-navigation">
                    <button class="nav-btn" id="prevBtn" onclick="paginaAnterior()">
                        ‚Üê Anterior
                    </button>
                    <div class="page-indicator">
                        <span id="pageInfo">P√°gina 1 de 1</span>
                    </div>
                    <button class="nav-btn" id="nextBtn" onclick="proximaPagina()">
                        Pr√≥xima ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </div>
<script>
        // ===== SISTEMA DE PERSIST√äNCIA COM FIREBASE =====
        const StorageManager = {
            KEYS: {
                MODULES: 'hooponopono_modules',
                AUDIOS: 'hooponopono_audios',
                DIARY: 'hooponopono_diary',
                USER: 'hooponopono_user'
            },

            // Salvar na nuvem (apenas admin) + local
            async save(key, data) {
                try {
                    // Sempre salvar localmente primeiro
                    const serialized = JSON.stringify(data);
                    if (typeof Storage !== "undefined") {
                        localStorage.setItem(key, serialized);
                    }
                    
                    // Se for admin e dados globais, salvar na nuvem
                    if (isAdmin && (key === this.KEYS.MODULES || key === this.KEYS.AUDIOS)) {
                        if (typeof firebase !== 'undefined' && firebase.database) {
                            await firebase.database().ref(key).set(data);
                            console.log('‚òÅÔ∏è Dados salvos na nuvem:', key);
                        }
                    }
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå Erro ao salvar:', error);
                    this.memoryStorage = this.memoryStorage || {};
                    this.memoryStorage[key] = data;
                    return false;
                }
            },

            // Carregar da nuvem primeiro, depois local
            async load(key, defaultValue = null) {
                try {
                    // Dados pessoais ficam sempre locais
                    if (key === this.KEYS.USER || key === this.KEYS.DIARY) {
                        return this.loadLocal(key, defaultValue);
                    }
                    
                    // M√≥dulos e √°udios: tentar nuvem primeiro
                    if (typeof firebase !== 'undefined' && firebase.database) {
                        try {
                            const snapshot = await firebase.database().ref(key).once('value');
                            const cloudData = snapshot.val();
                            
                            if (cloudData) {
                                console.log('üì• Dados carregados da nuvem:', key);
                                // Salvar cache local
                                this.saveLocal(key, cloudData);
                                return cloudData;
                            }
                        } catch (cloudError) {
                            console.log('‚ö†Ô∏è Erro na nuvem, usando dados locais:', cloudError.message);
                        }
                    }
                    
                    // Fallback para dados locais
                    return this.loadLocal(key, defaultValue);
                    
                } catch (error) {
                    console.error('‚ùå Erro geral ao carregar:', error);
                    return this.loadLocal(key, defaultValue);
                }
            },

            saveLocal(key, data) {
                try {
                    const serialized = JSON.stringify(data);
                    if (typeof Storage !== "undefined") {
                        localStorage.setItem(key, serialized);
                    } else {
                        this.memoryStorage = this.memoryStorage || {};
                        this.memoryStorage[key] = data;
                    }
                } catch (error) {
                    this.memoryStorage = this.memoryStorage || {};
                    this.memoryStorage[key] = data;
                }
            },

            loadLocal(key, defaultValue = null) {
                try {
                    if (typeof Storage !== "undefined") {
                        const item = localStorage.getItem(key);
                        if (item) {
                            return JSON.parse(item);
                        }
                    }
                    
                    if (this.memoryStorage && this.memoryStorage[key]) {
                        return this.memoryStorage[key];
                    }
                } catch (error) {
                    // Fallback silencioso
                }
                
                return defaultValue;
            },

            remove(key) {
                try {
                    if (typeof Storage !== "undefined") {
                        localStorage.removeItem(key);
                    }
                    if (this.memoryStorage) {
                        delete this.memoryStorage[key];
                    }
                    
                    // Se for admin, remover da nuvem tamb√©m
                    if (isAdmin && typeof firebase !== 'undefined' && firebase.database) {
                        firebase.database().ref(key).remove();
                    }
                } catch (error) {
                    // Silencioso
                }
            }
        };

        // Sistema de notifica√ß√µes toast
        const ToastManager = {
            show(message, type = 'info', duration = 3000) {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'slideIn 0.3s ease reverse';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, duration);
            },

            success(message) {
                this.show(message, 'success');
            },

            error(message) {
                this.show(message, 'error');
            }
        };

        // ===== VARI√ÅVEIS GLOBAIS =====
        let userName = '';
        let currentPage = 1;
        let totalPages = 1;
        let diaryEntries = [];
        let selectedImage = null;
        let postId = 0;
        let isAdmin = false;
        let cliquesSecretos = 0;
        let tempoUltimoClique = 0;

        // Configura√ß√£o do Admin
        const ADMIN_PASSWORD = '31536000';
        const ADMIN_USERNAME = 'Rita Mattos';

        // Vari√°veis para o editor
        let moduloAtualEditor = null;
        let paginaAtualEditor = 0;
        let elementosContador = 0;
        let audiosPersonalizados = [];
        let audioAtualTocando = null;

        // Conte√∫do dos m√≥dulos (agora persistente)
        let modules = {};

        // ===== INICIALIZA√á√ÉO COM FIREBASE =====
        async function inicializarDadosPadrao() {
            const modulosPadrao = {
                1: {
                    title: "M√≥dulo 1: Descobrindo o Ho'oponopono",
                    description: "Introdu√ß√£o √† pr√°tica havaiana",
                    pages: [
                        {
                            title: "üå∫ Aloha! Bem-vindo",
                            content: `<p style="line-height: 1.8; font-size: 1.1em;">Voc√™ est√° prestes a descobrir uma antiga pr√°tica havaiana que tem o poder de transformar sua vida atrav√©s do perd√£o, gratid√£o e amor.</p><div style="text-align: center; margin-top: 40px;"><p style="font-size: 1.3em; color: #10b981;">"A paz come√ßa comigo"</p></div>`
                        },
                        {
                            title: "As 4 Frases Sagradas",
                            content: `<div style="background: rgba(139, 92, 246, 0.2); padding: 30px; border-radius: 15px; text-align: center;"><p style="font-size: 1.5em; margin: 15px 0; color: #10b981;">Sinto muito</p><p style="font-size: 1.5em; margin: 15px 0; color: #10b981;">Me perdoe</p><p style="font-size: 1.5em; margin: 15px 0; color: #10b981;">Te amo</p><p style="font-size: 1.5em; margin: 15px 0; color: #10b981;">Sou grato</p></div>`
                        },
                        {
                            title: "Como Praticar",
                            content: `<p style="line-height: 1.8; font-size: 1.1em;">Simplesmente repita as quatro frases sempre que surgir um problema, conflito ou mem√≥ria dolorosa.</p><p style="line-height: 1.8; font-size: 1.1em; margin-top: 20px;">N√£o precisa entender, apenas confie no processo.</p>`
                        }
                    ]
                },
                2: {
                    title: "M√≥dulo 2: A Ci√™ncia da Responsabilidade",
                    description: "100% de responsabilidade",
                    pages: [
                        {
                            title: "100% Respons√°vel",
                            content: `<p style="line-height: 1.8; font-size: 1.1em;">"Voc√™ √© 100% respons√°vel por tudo que aparece em sua realidade" - Dr. Hew Len</p>`
                        },
                        {
                            title: "Mem√≥rias e Realidade",
                            content: `<p style="line-height: 1.8; font-size: 1.1em;">Nossas mem√≥rias subconscientes criam nossa realidade.</p>`
                        }
                    ]
                },
                3: {
                    title: "M√≥dulo 3: Conectando com o Divino",
                    description: "Os tr√™s selves",
                    pages: [
                        {
                            title: "Os Tr√™s Selves",
                            content: `<div style="text-align: center;"><h3 style="color: #a78bfa;">Unihipili - Crian√ßa Interior</h3><p>Guarda todas as mem√≥rias</p></div>`
                        }
                    ]
                }
            };

            // Carregar dados salvos ou usar padr√£o (COM AWAIT PARA FIREBASE)
            modules = await StorageManager.load(StorageManager.KEYS.MODULES, modulosPadrao);
            audiosPersonalizados = await StorageManager.load(StorageManager.KEYS.AUDIOS, []);
            diaryEntries = await StorageManager.load(StorageManager.KEYS.DIARY, []);
        }

        // ===== SISTEMA DE ACESSO ADMIN =====
        function contarCliquesSecretos() {
            const agora = Date.now();
            
            if (agora - tempoUltimoClique > 3000) {
                cliquesSecretos = 0;
            }
            
            cliquesSecretos++;
            tempoUltimoClique = agora;
            
            const logo = document.getElementById('logoSecret');
            if (logo) {
                logo.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    logo.style.transform = 'scale(1)';
                }, 150);
            }
            
            if (cliquesSecretos >= 5) {
                const botaoAdmin = document.getElementById('botaoAdminSecreto');
                if (botaoAdmin) {
                    botaoAdmin.style.display = 'block';
                    botaoAdmin.style.opacity = '0';
                    botaoAdmin.style.transform = 'scale(0.5)';
                    botaoAdmin.style.transition = 'all 0.5s ease';
                    
                    setTimeout(() => {
                        botaoAdmin.style.opacity = '1';
                        botaoAdmin.style.transform = 'scale(1)';
                    }, 100);
                    
                    ToastManager.success('üîê Acesso Admin Desbloqueado!');
                }
                
                cliquesSecretos = 0;
            }
        }

        // ===== FUN√á√ÉO PRINCIPAL DE LOGIN =====
        async function entrarApp() {
            const nome = document.getElementById('name').value.trim();
            
            if (!nome) {
                alert('Por favor, digite seu nome antes de continuar! üìù');
                return;
            }
            
            userName = nome;
            
            // Salvar usu√°rio (s√≥ local)
            StorageManager.saveLocal(StorageManager.KEYS.USER, { nome, lastLogin: new Date().toISOString() });
            
            // Atualizar interface
            const welcomeElement = document.getElementById('welcome');
            const splashElement = document.getElementById('splash');
            const mainElement = document.getElementById('main');
            
            if (welcomeElement) {
                welcomeElement.textContent = `Bem-vindo, ${nome}`;
            }
            
            if (splashElement && mainElement) {
                splashElement.style.display = 'none';
                mainElement.style.display = 'block';
            }
            
            // Carregar dados na interface
            await carregarModulosNaInterface();
            await carregarAudiosNaInterface();
            atualizarDiario();
            
            // Iniciar verifica√ß√£o de atualiza√ß√µes para alunos
            iniciarVerificacaoAtualizacoes();
            
            ToastManager.success(`Bem-vindo, ${nome}! üå∫`);
        }

        // ===== VERIFICA√á√ÉO DE ATUALIZA√á√ïES EM TEMPO REAL =====
        function iniciarVerificacaoAtualizacoes() {
            if (!isAdmin) {
                setInterval(async () => {
                    try {
                        const modulosAtualizados = await StorageManager.load(StorageManager.KEYS.MODULES);
                        const audiosAtualizados = await StorageManager.load(StorageManager.KEYS.AUDIOS);
                        
                        // Verificar se h√° diferen√ßas
                        if (JSON.stringify(modules) !== JSON.stringify(modulosAtualizados)) {
                            modules = modulosAtualizados;
                            carregarModulosNaInterface();
                            ToastManager.success('üì• Novos conte√∫dos dispon√≠veis!');
                        }
                        
                        if (JSON.stringify(audiosPersonalizados) !== JSON.stringify(audiosAtualizados)) {
                            audiosPersonalizados = audiosAtualizados;
                            carregarAudiosNaInterface();
                            ToastManager.success('üéµ Novos √°udios dispon√≠veis!');
                        }
                    } catch (error) {
                        // Erro silencioso
                    }
                }, 30000); // 30 segundos
            }
        }

        // ===== CARREGAR M√ìDULOS NA INTERFACE =====
        async function carregarModulosNaInterface() {
            const container = document.getElementById('modulesContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            Object.entries(modules).forEach(([id, module]) => {
                const card = document.createElement('div');
                card.className = 'module-card';
                card.onclick = () => abrirModulo(parseInt(id));
                
                card.innerHTML = `
                    <div class="module-number">${id}</div>
                    <h3 style="color: #e9d5ff; margin-bottom: 10px; font-size: clamp(1.1em, 4vw, 1.3em);">${module.title}</h3>
                    <p style="color: #c4b5fd; font-size: clamp(0.9em, 3vw, 1em);">${module.description}</p>
                    <p style="color: #86efac; margin-top: 10px; font-size: clamp(0.8em, 2.5vw, 0.9em);">‚ú® ${module.pages.length} p√°gina${module.pages.length !== 1 ? 's' : ''}</p>
                `;
                
                container.appendChild(card);
            });
        }

        // ===== CARREGAR √ÅUDIOS NA INTERFACE =====
        async function carregarAudiosNaInterface() {
            const audioGrid = document.getElementById('audioGrid');
            const mensagem = document.getElementById('mensagemSemAudios');
            
            if (!audioGrid || !mensagem) return;
            
            if (audiosPersonalizados.length === 0) {
                mensagem.style.display = 'block';
                const audiosAntigos = audioGrid.querySelectorAll('[id^="audio-container-"]');
                audiosAntigos.forEach(audio => audio.remove());
            } else {
                mensagem.style.display = 'none';
                const audiosAntigos = audioGrid.querySelectorAll('[id^="audio-container-"]');
                audiosAntigos.forEach(audio => audio.remove());
                
                audiosPersonalizados.forEach(audioData => {
                    criarElementoAudio(audioData);
                });
            }
        }

        // ===== FUN√á√ïES ADMIN =====
        function abrirLoginAdmin() {
            const loginModal = document.getElementById('loginAdmin');
            if (loginModal) {
                loginModal.style.display = 'flex';
            }
        }

        function fecharLoginAdmin() {
            const loginModal = document.getElementById('loginAdmin');
            if (loginModal) {
                loginModal.style.display = 'none';
                document.getElementById('adminUser').value = '';
                document.getElementById('adminPass').value = '';
            }
        }

        function fazerLoginAdmin() {
            const user = document.getElementById('adminUser').value.trim();
            const pass = document.getElementById('adminPass').value.trim();
            
            if (user === ADMIN_USERNAME && pass === ADMIN_PASSWORD) {
                isAdmin = true;
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('userLevel').textContent = 'N√≠vel: Administrador';
                fecharLoginAdmin();
                
                if (document.getElementById('main').style.display === 'none' || !document.getElementById('main').style.display) {
                    userName = user;
                    document.getElementById('welcome').textContent = `Bem-vindo, ${user}`;
                    document.getElementById('splash').style.display = 'none';
                    document.getElementById('main').style.display = 'block';
                    carregarModulosNaInterface();
                    carregarAudiosNaInterface();
                    atualizarDiario();
                }
                
                ToastManager.success('Login admin realizado com sucesso! üîê');
            } else {
                ToastManager.error('Credenciais inv√°lidas! ‚ùå');
            }
        }

        function logoutAdminSimples() {
            // Parar qualquer √°udio tocando
            if (audioAtualTocando) {
                try {
                    if (audioAtualTocando.pause) audioAtualTocando.pause();
                    if (audioAtualTocando.source && audioAtualTocando.source.stop) audioAtualTocando.source.stop();
                } catch (e) {}
                audioAtualTocando = null;
            }
            
            // Resetar vari√°veis
            isAdmin = false;
            userName = '';
            
            // Voltar para tela inicial
            document.getElementById('main').style.display = 'none';
            document.getElementById('splash').style.display = 'flex';
            
            // Limpar campos
            document.getElementById('name').value = '';
            document.getElementById('welcome').textContent = 'Bem-vindo';
            document.getElementById('userLevel').textContent = 'N√≠vel: Iniciante';
            
            // Esconder pain√©is admin
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('painelAdmin').style.display = 'none';
            document.getElementById('botaoAdminSecreto').style.display = 'none';
            
            // Recarregar √°udios sem bot√µes de excluir
            carregarAudiosNaInterface();
            
            ToastManager.success('Logout admin realizado! üë§');
        }

        function abrirPainelAdmin() {
            if (isAdmin) {
                document.getElementById('painelAdmin').style.display = 'block';
                carregarSeletorModulos();
                atualizarEstatisticas();
            } else {
                ToastManager.error('Acesso negado! Fa√ßa login como admin primeiro.');
            }
        }

        function fecharPainelAdmin() {
            document.getElementById('painelAdmin').style.display = 'none';
        }

        function carregarSeletorModulos() {
            const seletor = document.getElementById('seletorModulo');
            if (!seletor) return;
            
            seletor.innerHTML = '<option value="">Selecione um m√≥dulo para editar</option>';
            
            Object.entries(modules).forEach(([id, module]) => {
                const option = document.createElement('option');
                option.value = id;
                option.textContent = module.title;
                seletor.appendChild(option);
            });
        }

        function atualizarEstatisticas() {
            const statModulos = document.getElementById('statModulos');
            const statPaginas = document.getElementById('statPaginas');
            const statAudios = document.getElementById('statAudios');
            
            if (statModulos) statModulos.textContent = Object.keys(modules).length;
            
            if (statPaginas) {
                let totalPaginas = 0;
                Object.values(modules).forEach(mod => {
                    totalPaginas += mod.pages.length;
                });
                statPaginas.textContent = totalPaginas;
            }
            
            if (statAudios) statAudios.textContent = audiosPersonalizados.length;
        }
function atualizarEstatisticas() {
            const statModulos = document.getElementById('statModulos');
            const statPaginas = document.getElementById('statPaginas');
            const statAudios = document.getElementById('statAudios');
            
            if (statModulos) statModulos.textContent = Object.keys(modules).length;
            
            if (statPaginas) {
                let totalPaginas = 0;
                Object.values(modules).forEach(mod => {
                    totalPaginas += mod.pages.length;
                });
                statPaginas.textContent = totalPaginas;
            }
            
            if (statAudios) statAudios.textContent = audiosPersonalizados.length;
        }

        // ===== CRIAR NOVO M√ìDULO COM FIREBASE =====
        async function criarNovoModulo() {
            const titulo = document.getElementById('novoModuloTitulo').value.trim();
            const descricao = document.getElementById('novoModuloDescricao').value.trim();
            
            if (!titulo || !descricao) {
                ToastManager.error('Digite o t√≠tulo e a descri√ß√£o do m√≥dulo!');
                return;
            }
            
            const novoId = Math.max(...Object.keys(modules).map(k => parseInt(k)), 0) + 1;
            modules[novoId] = {
                title: titulo,
                description: descricao,
                pages: [
                    {
                        title: "P√°gina Inicial",
                        content: `<p style="line-height: 1.8; font-size: 1.1em;">${descricao}</p>`
                    }
                ]
            };
            
            // Salvar e atualizar IMEDIATAMENTE na nuvem
            await StorageManager.save(StorageManager.KEYS.MODULES, modules);
            carregarModulosNaInterface();
            carregarSeletorModulos();
            atualizarEstatisticas();
            
            document.getElementById('novoModuloTitulo').value = '';
            document.getElementById('novoModuloDescricao').value = '';
            
            ToastManager.success('M√≥dulo criado com sucesso! ‚úÖ Dispon√≠vel na nuvem para todos!');
        }

        function carregarModuloEditor() {
            const moduloId = document.getElementById('seletorModulo').value;
            if (!moduloId) {
                document.getElementById('editorPaginas').style.display = 'none';
                return;
            }
            
            moduloAtualEditor = moduloId;
            document.getElementById('editorPaginas').style.display = 'block';
            atualizarListaPaginas();
        }

        function atualizarListaPaginas() {
            const modulo = modules[moduloAtualEditor];
            const lista = document.getElementById('listaPaginas');
            
            lista.innerHTML = modulo.pages.map((page, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: clamp(8px, 2vw, 10px); margin-bottom: 5px; background: rgba(0,0,0,0.3); border-radius: 5px; gap: 10px;">
                    <span style="color: white; font-size: clamp(12px, 3vw, 14px); flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis;">P√°gina ${index + 1}: ${page.title}</span>
                    <button style="background: #8b5cf6; color: white; border: none; padding: clamp(4px, 1vw, 5px) clamp(8px, 2vw, 10px); border-radius: 3px; cursor: pointer; font-size: clamp(11px, 2.5vw, 13px); min-height: 32px; white-space: nowrap;" onclick="editarPagina(${index})">Editar</button>
                </div>
            `).join('');
        }

        // ===== EDITOR DE P√ÅGINAS ATUALIZADO =====
        function editarPagina(index) {
            paginaAtualEditor = index;
            const modulo = modules[moduloAtualEditor];
            const pagina = modulo.pages[index];
            
            document.getElementById('editorPaginaAtual').style.display = 'block';
            document.getElementById('numeroPaginaAtual').textContent = index + 1;
            document.getElementById('tituloPagina').value = pagina.title;
            
            const areaConteudo = document.getElementById('areaConteudo');
            areaConteudo.innerHTML = '';
            elementosContador = 0;
            
            // Se h√° conte√∫do, extrair e criar campos edit√°veis
            if (pagina.content && pagina.content.trim()) {
                extrairECriarCamposEditaveis(pagina.content, areaConteudo);
            } else {
                areaConteudo.innerHTML = '<p style="color: #999; text-align: center;">Clique nos bot√µes acima para adicionar elementos √† p√°gina</p>';
            }
        }

        // Fun√ß√£o para extrair conte√∫do HTML e criar campos edit√°veis
        function extrairECriarCamposEditaveis(htmlContent, container) {
            const parser = new DOMParser();
            const doc = parser.parseFromString('<div>' + htmlContent + '</div>', 'text/html');
            const elementos = doc.body.firstChild.children;
            
            for (let elemento of elementos) {
                if (elemento.tagName === 'H1' || elemento.tagName === 'H2') {
                    adicionarElementoExistente('titulo', elemento.textContent);
                } else if (elemento.tagName === 'H3' || elemento.tagName === 'H4') {
                    adicionarElementoExistente('subtitulo', elemento.textContent);
                } else if (elemento.tagName === 'P') {
                    adicionarElementoExistente('texto', elemento.textContent);
                } else if (elemento.tagName === 'DIV' && elemento.innerHTML.includes('Sinto muito')) {
                    // Adicionar quadro das 4 frases
                    adicionarElementoEspecial('frases4');
                }
            }
            
            if (container.children.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center;">Clique nos bot√µes acima para adicionar elementos √† p√°gina</p>';
            }
        }

        // Fun√ß√£o para adicionar elemento existente
        function adicionarElementoExistente(tipo, conteudo) {
            elementosContador++;
            const areaConteudo = document.getElementById('areaConteudo');
            
            if (areaConteudo.innerHTML.includes('Clique nos bot√µes')) {
                areaConteudo.innerHTML = '';
            }
            
            let novoElemento = '';
            
            switch (tipo) {
                case 'titulo':
                    novoElemento = `
                        <div data-elemento="${elementosContador}" style="margin-bottom: 15px; padding: clamp(8px, 2vw, 10px); border: 1px dashed #8b5cf6; border-radius: 5px; position: relative;">
                            <button onclick="removerElemento(${elementosContador})" style="position: absolute; top: 5px; right: 5px; background: #ef4444; color: white; border: none; width: clamp(16px, 4vw, 20px); height: clamp(16px, 4vw, 20px); border-radius: 50%; font-size: clamp(10px, 2vw, 12px); cursor: pointer;">√ó</button>
                            <label style="color: #8b5cf6; font-size: clamp(11px, 2.5vw, 13px); display: block; margin-bottom: 5px;">üìù T√≠tulo</label>
                            <input type="text" value="${conteudo}" placeholder="Digite o t√≠tulo..." style="width: 100%; padding: clamp(6px, 2vw, 8px); background: rgba(0,0,0,0.3); border: 1px solid #8b5cf6; border-radius: 3px; color: #8b5cf6; font-size: clamp(14px, 3vw, 16px);">
                        </div>
                    `;
                    break;
                case 'subtitulo':
                    novoElemento = `
                        <div data-elemento="${elementosContador}" style="margin-bottom: 15px; padding: clamp(8px, 2vw, 10px); border: 1px dashed #10b981; border-radius: 5px; position: relative;">
                            <button onclick="removerElemento(${elementosContador})" style="position: absolute; top: 5px; right: 5px; background: #ef4444; color: white; border: none; width: clamp(16px, 4vw, 20px); height: clamp(16px, 4vw, 20px); border-radius: 50%; font-size: clamp(10px, 2vw, 12px); cursor: pointer;">√ó</button>
                            <label style="color: #10b981; font-size: clamp(11px, 2.5vw, 13px); display: block; margin-bottom: 5px;">üìã Subt√≠tulo</label>
                            <input type="text" value="${conteudo}" placeholder="Digite o subt√≠tulo..." style="width: 100%; padding: clamp(6px, 2vw, 8px); background: rgba(0,0,0,0.3); border: 1px solid #10b981; border-radius: 3px; color: #10b981; font-size: clamp(14px, 3vw, 16px);">
                        </div>
                    `;
                    break;
                case 'texto':
                    novoElemento = `
                        <div data-elemento="${elementosContador}" style="margin-bottom: 15px; padding: clamp(8px, 2vw, 10px); border: 1px dashed #f59e0b; border-radius: 5px; position: relative;">
                            <button onclick="removerElemento(${elementosContador})" style="position: absolute; top: 5px; right: 5px; background: #ef4444; color: white; border: none; width: clamp(16px, 4vw, 20px); height: clamp(16px, 4vw, 20px); border-radius: 50%; font-size: clamp(10px, 2vw, 12px); cursor: pointer;">√ó</button>
                            <label style="color: #f59e0b; font-size: clamp(11px, 2.5vw, 13px); display: block; margin-bottom: 5px;">üìÑ Texto</label>
                            <textarea placeholder="Digite o texto..." style="width: 100%; height: clamp(80px, 20vw, 100px); padding: clamp(6px, 2vw, 8px); background: rgba(0,0,0,0.3); border: 1px solid #f59e0b; border-radius: 3px; color: white; resize: vertical; font-size: clamp(14px, 3vw, 16px);">${conteudo}</textarea>
                        </div>
                    `;
                    break;
            }
            
            areaConteudo.insertAdjacentHTML('beforeend', novoElemento);
        }

        // Fun√ß√£o para adicionar elementos especiais
        function adicionarElementoEspecial(tipo) {
            elementosContador++;
            const areaConteudo = document.getElementById('areaConteudo');
            
            if (areaConteudo.innerHTML.includes('Clique nos bot√µes')) {
                areaConteudo.innerHTML = '';
            }
            
            if (tipo === 'frases4') {
                const novoElemento = `
                    <div data-elemento="${elementosContador}" style="margin-bottom: 15px; padding: clamp(8px, 2vw, 10px); border: 1px dashed #a78bfa; border-radius: 5px; position: relative;">
                        <button onclick="removerElemento(${elementosContador})" style="position: absolute; top: 5px; right: 5px; background: #ef4444; color: white; border: none; width: clamp(16px, 4vw, 20px); height: clamp(16px, 4vw, 20px); border-radius: 50%; font-size: clamp(10px, 2vw, 12px); cursor: pointer;">√ó</button>
                        <label style="color: #a78bfa; font-size: clamp(11px, 2.5vw, 13px); display: block; margin-bottom: 10px;">üå∫ As 4 Frases Sagradas</label>
                        <div style="background: rgba(139, 92, 246, 0.2); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="margin-bottom: 10px;">
                                <label style="color: #10b981; font-size: clamp(10px, 2vw, 12px);">Frase 1:</label>
                                <input type="text" value="Sinto muito" style="width: 100%; margin-top: 5px; padding: clamp(4px, 1vw, 6px); background: rgba(0,0,0,0.3); border: 1px solid #10b981; border-radius: 3px; color: #10b981; text-align: center; font-size: clamp(12px, 3vw, 14px);">
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label style="color: #10b981; font-size: clamp(10px, 2vw, 12px);">Frase 2:</label>
                                <input type="text" value="Me perdoe" style="width: 100%; margin-top: 5px; padding: clamp(4px, 1vw, 6px); background: rgba(0,0,0,0.3); border: 1px solid #10b981; border-radius: 3px; color: #10b981; text-align: center; font-size: clamp(12px, 3vw, 14px);">
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label style="color: #10b981; font-size: clamp(10px, 2vw, 12px);">Frase 3:</label>
                                <input type="text" value="Te amo" style="width: 100%; margin-top: 5px; padding: clamp(4px, 1vw, 6px); background: rgba(0,0,0,0.3); border: 1px solid #10b981; border-radius: 3px; color: #10b981; text-align: center; font-size: clamp(12px, 3vw, 14px);">
                            </div>
                            <div>
                                <label style="color: #10b981; font-size: clamp(10px, 2vw, 12px);">Frase 4:</label>
                                <input type="text" value="Sou grato" style="width: 100%; margin-top: 5px; padding: clamp(4px, 1vw, 6px); background: rgba(0,0,0,0.3); border: 1px solid #10b981; border-radius: 3px; color: #10b981; text-align: center; font-size: clamp(12px, 3vw, 14px);">
                            </div>
                        </div>
                    </div>
                `;
                areaConteudo.insertAdjacentHTML('beforeend', novoElemento);
            }
        }

        // Fun√ß√£o principal para adicionar elementos
        function adicionarElemento(tipo) {
            elementosContador++;
            const areaConteudo = document.getElementById('areaConteudo');
            
            // Remover mensagem padr√£o se existir
            if (areaConteudo.innerHTML.includes('Clique nos bot√µes')) {
                areaConteudo.innerHTML = '';
            }
            
            let novoElemento = '';
            
            switch (tipo) {
                case 'titulo':
                    novoElemento = `
                        <div data-elemento="${elementosContador}" style="margin-bottom: 15px; padding: clamp(8px, 2vw, 10px); border: 1px dashed #8b5cf6; border-radius: 5px; position: relative;">
                            <button onclick="removerElemento(${elementosContador})" style="position: absolute; top: 5px; right: 5px; background: #ef4444; color: white; border: none; width: clamp(16px, 4vw, 20px); height: clamp(16px, 4vw, 20px); border-radius: 50%; font-size: clamp(10px, 2vw, 12px); cursor: pointer;">√ó</button>
                            <label style="color: #8b5cf6; font-size: clamp(11px, 2.5vw, 13px); display: block; margin-bottom: 5px;">üìù T√≠tulo</label>
                            <input type="text" placeholder="Digite o t√≠tulo..." style="width: 100%; padding: clamp(6px, 2vw, 8px); background: rgba(0,0,0,0.3); border: 1px solid #8b5cf6; border-radius: 3px; color: #8b5cf6; font-size: clamp(14px, 3vw, 16px);">
                        </div>
                    `;
                    break;
                case 'subtitulo':
                    novoElemento = `
                        <div data-elemento="${elementosContador}" style="margin-bottom: 15px; padding: clamp(8px, 2vw, 10px); border: 1px dashed #10b981; border-radius: 5px; position: relative;">
                            <button onclick="removerElemento(${elementosContador})" style="position: absolute; top: 5px; right: 5px; background: #ef4444; color: white; border: none; width: clamp(16px, 4vw, 20px); height: clamp(16px, 4vw, 20px); border-radius: 50%; font-size: clamp(10px, 2vw, 12px); cursor: pointer;">√ó</button>
                            <label style="color: #10b981; font-size: clamp(11px, 2.5vw, 13px); display: block; margin-bottom: 5px;">üìã Subt√≠tulo</label>
                            <input type="text" placeholder="Digite o subt√≠tulo..." style="width: 100%; padding: clamp(6px, 2vw, 8px); background: rgba(0,0,0,0.3); border: 1px solid #10b981; border-radius: 3px; color: #10b981; font-size: clamp(14px, 3vw, 16px);">
                        </div>
                    `;
                    break;
                case 'texto':
                    novoElemento = `
                        <div data-elemento="${elementosContador}" style="margin-bottom: 15px; padding: clamp(8px, 2vw, 10px); border: 1px dashed #f59e0b; border-radius: 5px; position: relative;">
                            <button onclick="removerElemento(${elementosContador})" style="position: absolute; top: 5px; right: 5px; background: #ef4444; color: white; border: none; width: clamp(16px, 4vw, 20px); height: clamp(16px, 4vw, 20px); border-radius: 50%; font-size: clamp(10px, 2vw, 12px); cursor: pointer;">√ó</button>
                            <label style="color: #f59e0b; font-size: clamp(11px, 2.5vw, 13px); display: block; margin-bottom: 5px;">üìÑ Texto</label>
                            <textarea placeholder="Digite o texto..." style="width: 100%; height: clamp(80px, 20vw, 100px); padding: clamp(6px, 2vw, 8px); background: rgba(0,0,0,0.3); border: 1px solid #f59e0b; border-radius: 3px; color: white; resize: vertical; font-size: clamp(14px, 3vw, 16px);"></textarea>
                        </div>
                    `;
                    break;
                case 'imagem':
                    novoElemento = `
                        <div data-elemento="${elementosContador}" style="margin-bottom: 15px; padding: clamp(8px, 2vw, 10px); border: 1px dashed #ef4444; border-radius: 5px; position: relative;">
                            <button onclick="removerElemento(${elementosContador})" style="position: absolute; top: 5px; right: 5px; background: #ef4444; color: white; border: none; width: clamp(16px, 4vw, 20px); height: clamp(16px, 4vw, 20px); border-radius: 50%; font-size: clamp(10px, 2vw, 12px); cursor: pointer;">√ó</button>
                            <label style="color: #ef4444; font-size: clamp(11px, 2.5vw, 13px); display: block; margin-bottom: 5px;">üñºÔ∏è Imagem</label>
                            <input type="file" accept="image/*" onchange="processarImagemUpload(this, ${elementosContador})" style="width: 100%; padding: clamp(6px, 2vw, 8px); background: rgba(0,0,0,0.3); border: 1px solid #ef4444; border-radius: 3px; color: white; font-size: clamp(14px, 3vw, 16px); margin-bottom: 10px;">
                            <div id="preview-${elementosContador}" style="display: none; text-align: center; margin-top: 10px;">
                                <img id="img-preview-${elementosContador}" style="max-width: 100%; max-height: 200px; border-radius: 5px; border: 1px solid #ef4444;">
                                <p style="color: #ef4444; font-size: clamp(10px, 2.5vw, 12px); margin-top: 5px;">Preview da imagem</p>
                            </div>
                            <input type="hidden" id="base64-${elementosContador}" value="">
                        </div>
                    `;
                    break;
                case 'frases4':
                    novoElemento = `
                        <div data-elemento="${elementosContador}" style="margin-bottom: 15px; padding: clamp(8px, 2vw, 10px); border: 1px dashed #a78bfa; border-radius: 5px; position: relative;">
                            <button onclick="removerElemento(${elementosContador})" style="position: absolute; top: 5px; right: 5px; background: #ef4444; color: white; border: none; width: clamp(16px, 4vw, 20px); height: clamp(16px, 4vw, 20px); border-radius: 50%; font-size: clamp(10px, 2vw, 12px); cursor: pointer;">√ó</button>
                            <label style="color: #a78bfa; font-size: clamp(11px, 2.5vw, 13px); display: block; margin-bottom: 10px;">üå∫ As 4 Frases Sagradas</label>
                            <div style="background: rgba(139, 92, 246, 0.2); padding: 20px; border-radius: 10px; text-align: center;">
                                <div style="margin-bottom: 10px;">
                                    <label style="color: #10b981; font-size: clamp(10px, 2vw, 12px);">Frase 1:</label>
                                    <input type="text" value="Sinto muito" style="width: 100%; margin-top: 5px; padding: clamp(4px, 1vw, 6px); background: rgba(0,0,0,0.3); border: 1px solid #10b981; border-radius: 3px; color: #10b981; text-align: center; font-size: clamp(12px, 3vw, 14px);">
                                </div>
                                <div style="margin-bottom: 10px;">
                                    <label style="color: #10b981; font-size: clamp(10px, 2vw, 12px);">Frase 2:</label>
                                    <input type="text" value="Me perdoe" style="width: 100%; margin-top: 5px; padding: clamp(4px, 1vw, 6px); background: rgba(0,0,0,0.3); border: 1px solid #10b981; border-radius: 3px; color: #10b981; text-align: center; font-size: clamp(12px, 3vw, 14px);">
                                </div>
                                <div style="margin-bottom: 10px;">
                                    <label style="color: #10b981; font-size: clamp(10px, 2vw, 12px);">Frase 3:</label>
                                    <input type="text" value="Te amo" style="width: 100%; margin-top: 5px; padding: clamp(4px, 1vw, 6px); background: rgba(0,0,0,0.3); border: 1px solid #10b981; border-radius: 3px; color: #10b981; text-align: center; font-size: clamp(12px, 3vw, 14px);">
                                </div>
                                <div>
                                    <label style="color: #10b981; font-size: clamp(10px, 2vw, 12px);">Frase 4:</label>
                                    <input type="text" value="Sou grato" style="width: 100%; margin-top: 5px; padding: clamp(4px, 1vw, 6px); background: rgba(0,0,0,0.3); border: 1px solid #10b981; border-radius: 3px; color: #10b981; text-align: center; font-size: clamp(12px, 3vw, 14px);">
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            areaConteudo.insertAdjacentHTML('beforeend', novoElemento);
        }

        function processarImagemUpload(input, elementoId) {
            const arquivo = input.files[0];
            
            if (!arquivo) {
                const preview = document.getElementById(`preview-${elementoId}`);
                if (preview) preview.style.display = 'none';
                return;
            }
            
            if (!arquivo.type.startsWith('image/')) {
                ToastManager.error('Por favor, selecione apenas arquivos de imagem!');
                input.value = '';
                return;
            }
            
            // Verificar tamanho (m√°ximo 5MB)
            if (arquivo.size > 5 * 1024 * 1024) {
                ToastManager.error('Imagem muito grande! M√°ximo 5MB.');
                input.value = '';
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const base64 = e.target.result;
                
                // Salvar base64 no campo hidden
                const hiddenInput = document.getElementById(`base64-${elementoId}`);
                if (hiddenInput) {
                    hiddenInput.value = base64;
                }
                
                // Mostrar preview
                const preview = document.getElementById(`preview-${elementoId}`);
                const imgPreview = document.getElementById(`img-preview-${elementoId}`);
                
                if (preview && imgPreview) {
                    imgPreview.src = base64;
                    preview.style.display = 'block';
                }
                
                ToastManager.success('Imagem carregada com sucesso! üì∏');
            };
            
            reader.onerror = function() {
                ToastManager.error('Erro ao ler a imagem!');
                input.value = '';
            };
            
            reader.readAsDataURL(arquivo);
        }

        function removerElemento(id) {
            const elemento = document.querySelector(`[data-elemento="${id}"]`);
            if (elemento) {
                elemento.remove();
                
                // Se n√£o h√° mais elementos, mostrar mensagem padr√£o
                const areaConteudo = document.getElementById('areaConteudo');
                if (areaConteudo.children.length === 0) {
                    areaConteudo.innerHTML = '<p style="color: #999; text-align: center;">Clique nos bot√µes acima para adicionar elementos √† p√°gina</p>';
                }
            }
        }

        function adicionarNovaPagina() {
            const modulo = modules[moduloAtualEditor];
            modulo.pages.push({
                title: `Nova P√°gina ${modulo.pages.length + 1}`,
                content: '<p style="line-height: 1.8; font-size: 1.1em;">Conte√∫do da nova p√°gina...</p>'
            });
            
            StorageManager.save(StorageManager.KEYS.MODULES, modules);
            carregarModulosNaInterface();
            atualizarListaPaginas();
            atualizarEstatisticas();
            editarPagina(modulo.pages.length - 1);
        }

        // FUN√á√ÉO SALVAR P√ÅGINA ATUALIZADA COM FIREBASE
        async function salvarPaginaAtual() {
            const titulo = document.getElementById('tituloPagina').value.trim();
            
            if (!titulo) {
                ToastManager.error('Digite o t√≠tulo da p√°gina!');
                return;
            }
            
            // Gerar HTML a partir dos elementos visuais
            const areaConteudo = document.getElementById('areaConteudo');
            let htmlFinal = '';
            
            const elementos = areaConteudo.querySelectorAll('[data-elemento]');
            elementos.forEach(elemento => {
                const label = elemento.querySelector('label').textContent;
                
                if (label.includes('T√≠tulo')) {
                    const valor = elemento.querySelector('input').value;
                    htmlFinal += `<h2 style="color: #8b5cf6; font-size: 1.5em; margin-bottom: 15px;">${valor}</h2>`;
                } else if (label.includes('Subt√≠tulo')) {
                    const valor = elemento.querySelector('input').value;
                    htmlFinal += `<h3 style="color: #10b981; font-size: 1.3em; margin-bottom: 10px;">${valor}</h3>`;
                } else if (label.includes('Texto')) {
                    const valor = elemento.querySelector('textarea').value;
                    htmlFinal += `<p style="line-height: 1.8; font-size: 1.1em; margin-bottom: 15px;">${valor}</p>`;
                } else if (label.includes('Imagem')) {
                    const hiddenInput = elemento.querySelector('input[type="hidden"]');
                    const base64Value = hiddenInput ? hiddenInput.value : '';
                    if (base64Value) {
                        htmlFinal += `<div style="text-align: center; margin: 20px 0;"><img src="${base64Value}" style="max-width: 100%; border-radius: 10px;" alt="Imagem"></div>`;
                    }
                } else if (label.includes('4 Frases')) {
                    const inputs = elemento.querySelectorAll('input');
                    htmlFinal += `<div style="background: rgba(139, 92, 246, 0.2); padding: 30px; border-radius: 15px; text-align: center;">`;
                    inputs.forEach(input => {
                        htmlFinal += `<p style="font-size: 1.5em; margin: 15px 0; color: #10b981;">${input.value}</p>`;
                    });
                    htmlFinal += `</div>`;
                }
            });
            
            // Salvar no m√≥dulo
            const modulo = modules[moduloAtualEditor];
            modulo.pages[paginaAtualEditor].title = titulo;
            modulo.pages[paginaAtualEditor].content = htmlFinal;
            
            // SALVAR NA NUVEM COM FIREBASE
            await StorageManager.save(StorageManager.KEYS.MODULES, modules);
            
            // Atualizar interface para todos os usu√°rios
            carregarModulosNaInterface();
            atualizarListaPaginas();
            atualizarEstatisticas();
            
            ToastManager.success('P√°gina salva com sucesso! ‚úÖ Sincronizada na nuvem!');
        }

        function excluirPaginaAtual() {
            if (confirm('Tem certeza que deseja excluir esta p√°gina?')) {
                const modulo = modules[moduloAtualEditor];
                if (modulo.pages.length > 1) {
                    modulo.pages.splice(paginaAtualEditor, 1);
                    
                    StorageManager.save(StorageManager.KEYS.MODULES, modules);
                    carregarModulosNaInterface();
                    atualizarListaPaginas();
                    atualizarEstatisticas();
                    document.getElementById('editorPaginaAtual').style.display = 'none';
                    
                    ToastManager.success('P√°gina exclu√≠da! ‚úÖ');
                } else {
                    ToastManager.error('N√£o √© poss√≠vel excluir a √∫ltima p√°gina do m√≥dulo!');
                }
            }
        }

        // ===== EFEITOS SONOROS =====
        function criarSomPagina() {
            // Criar som de p√°gina virando usando Web Audio API
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Criar som sint√©tico de papel
            const buffer = audioContext.createBuffer(1, audioContext.sampleRate * 0.3, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            
            for (let i = 0; i < buffer.length; i++) {
                // Som de papel com frequ√™ncia vari√°vel
                const t = i / audioContext.sampleRate;
                const freq1 = 800 + Math.sin(t * 20) * 200; // Frequ√™ncia principal
                const freq2 = 1200 + Math.sin(t * 15) * 150; // Frequ√™ncia secund√°ria
                
                let sample = Math.sin(2 * Math.PI * freq1 * t) * 0.3;
                sample += Math.sin(2 * Math.PI * freq2 * t) * 0.2;
                
                // Envelope para simular o "whoosh" do papel
                const envelope = Math.exp(-t * 8) * (1 - Math.exp(-t * 30));
                
                // Adicionar ru√≠do para simular textura do papel
                const noise = (Math.random() - 0.5) * 0.1;
                
                data[i] = (sample + noise) * envelope * 0.4;
            }
            
            return buffer;
        }

        function tocarSomPagina() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const buffer = criarSomPagina();
                const source = audioContext.createBufferSource();
                const gainNode = audioContext.createGain();
                
                source.buffer = buffer;
                source.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Volume baixo para n√£o incomodar
                gainNode.gain.value = 0.3;
                
                source.start(0);
            } catch (error) {
                // Se n√£o conseguir tocar o som, n√£o faz nada (modo silencioso)
            }
        }<script>
        // ===== SISTEMA DE PERSIST√äNCIA COM FIREBASE =====
        const StorageManager = {
            KEYS: {
                MODULES: 'hooponopono_modules',
                AUDIOS: 'hooponopono_audios',
                DIARY: 'hooponopono_diary',
                USER: 'hooponopono_user'
            },

            // Salvar na nuvem (apenas admin) + local
            async save(key, data) {
                try {
                    // Sempre salvar localmente primeiro
                    const serialized = JSON.stringify(data);
                    if (typeof Storage !== "undefined") {
                        localStorage.setItem(key, serialized);
                    }
                    
                    // Se for admin e dados globais, salvar na nuvem
                    if (isAdmin && (key === this.KEYS.MODULES || key === this.KEYS.AUDIOS)) {
                        if (typeof firebase !== 'undefined' && firebase.database) {
                            await firebase.database().ref(key).set(data);
                            console.log('‚òÅÔ∏è Dados salvos na nuvem:', key);
                        }
                    }
                    
                    return true;
                } catch (error) {
                    console.error('‚ùå Erro ao salvar:', error);
                    this.memoryStorage = this.memoryStorage || {};
                    this.memoryStorage[key] = data;
                    return false;
                }
            },

            // Carregar da nuvem primeiro, depois local
            async load(key, defaultValue = null) {
                try {
                    // Dados pessoais ficam sempre locais
                    if (key === this.KEYS.USER || key === this.KEYS.DIARY) {
                        return this.loadLocal(key, defaultValue);
                    }
                    
                    // M√≥dulos e √°udios: tentar nuvem primeiro
                    if (typeof firebase !== 'undefined' && firebase.database) {
                        try {
                            const snapshot = await firebase.database().ref(key).once('value');
                            const cloudData = snapshot.val();
                            
                            if (cloudData) {
                                console.log('üì• Dados carregados da nuvem:', key);
                                // Salvar cache local
                                this.saveLocal(key, cloudData);
                                return cloudData;
                            }
                        } catch (cloudError) {
                            console.log('‚ö†Ô∏è Erro na nuvem, usando dados locais:', cloudError.message);
                        }
                    }
                    
                    // Fallback para dados locais
                    return this.loadLocal(key, defaultValue);
                    
                } catch (error) {
                    console.error('‚ùå Erro geral ao carregar:', error);
                    return this.loadLocal(key, defaultValue);
                }
            },

            saveLocal(key, data) {
                try {
                    const serialized = JSON.stringify(data);
                    if (typeof Storage !== "undefined") {
                        localStorage.setItem(key, serialized);
                    } else {
                        this.memoryStorage = this.memoryStorage || {};
                        this.memoryStorage[key] = data;
                    }
                } catch (error) {
                    this.memoryStorage = this.memoryStorage || {};
                    this.memoryStorage[key] = data;
                }
            },

            loadLocal(key, defaultValue = null) {
                try {
                    if (typeof Storage !== "undefined") {
                        const item = localStorage.getItem(key);
                        if (item) {
                            return JSON.parse(item);
                        }
                    }
                    
                    if (this.memoryStorage && this.memoryStorage[key]) {
                        return this.memoryStorage[key];
                    }
                } catch (error) {
                    // Fallback silencioso
                }
                
                return defaultValue;
            },

            remove(key) {
                try {
                    if (typeof Storage !== "undefined") {
                        localStorage.removeItem(key);
                    }
                    if (this.memoryStorage) {
                        delete this.memoryStorage[key];
                    }
                    
                    // Se for admin, remover da nuvem tamb√©m
                    if (isAdmin && typeof firebase !== 'undefined' && firebase.database) {
                        firebase.database().ref(key).remove();
                    }
                } catch (error) {
                    // Silencioso
                }
            }
        };

        // Sistema de notifica√ß√µes toast
        const ToastManager = {
            show(message, type = 'info', duration = 3000) {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'slideIn 0.3s ease reverse';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, duration);
            },

            success(message) {
                this.show(message, 'success');
            },

            error(message) {
                this.show(message, 'error');
            }
        };

        // ===== VARI√ÅVEIS GLOBAIS =====
        let userName = '';
        let currentPage = 1;
        let totalPages = 1;
        let diaryEntries = [];
        let selectedImage = null;
        let postId = 0;
        let isAdmin = false;
        let cliquesSecretos = 0;
        let tempoUltimoClique = 0;

        // Configura√ß√£o do Admin
        const ADMIN_PASSWORD = '31536000';
        const ADMIN_USERNAME = 'Rita Mattos';

        // Vari√°veis para o editor
        let moduloAtualEditor = null;
        let paginaAtualEditor = 0;
        let elementosContador = 0;
        let audiosPersonalizados = [];
        let audioAtualTocando = null;

        // Conte√∫do dos m√≥dulos (agora persistente)
        let modules = {};

        // ===== INICIALIZA√á√ÉO COM FIREBASE =====
        async function inicializarDadosPadrao() {
            const modulosPadrao = {
                1: {
                    title: "M√≥dulo 1: Descobrindo o Ho'oponopono",
                    description: "Introdu√ß√£o √† pr√°tica havaiana",
                    pages: [
                        {
                            title: "üå∫ Aloha! Bem-vindo",
                            content: `<p style="line-height: 1.8; font-size: 1.1em;">Voc√™ est√° prestes a descobrir uma antiga pr√°tica havaiana que tem o poder de transformar sua vida atrav√©s do perd√£o, gratid√£o e amor.</p><div style="text-align: center; margin-top: 40px;"><p style="font-size: 1.3em; color: #10b981;">"A paz come√ßa comigo"</p></div>`
                        },
                        {
                            title: "As 4 Frases Sagradas",
                            content: `<div style="background: rgba(139, 92, 246, 0.2); padding: 30px; border-radius: 15px; text-align: center;"><p style="font-size: 1.5em; margin: 15px 0; color: #10b981;">Sinto muito</p><p style="font-size: 1.5em; margin: 15px 0; color: #10b981;">Me perdoe</p><p style="font-size: 1.5em; margin: 15px 0; color: #10b981;">Te amo</p><p style="font-size: 1.5em; margin: 15px 0; color: #10b981;">Sou grato</p></div>`
                        },
                        {
                            title: "Como Praticar",
                            content: `<p style="line-height: 1.8; font-size: 1.1em;">Simplesmente repita as quatro frases sempre que surgir um problema, conflito ou mem√≥ria dolorosa.</p><p style="line-height: 1.8; font-size: 1.1em; margin-top: 20px;">N√£o precisa entender, apenas confie no processo.</p>`
                        }
                    ]
                },
                2: {
                    title: "M√≥dulo 2: A Ci√™ncia da Responsabilidade",
                    description: "100% de responsabilidade",
                    pages: [
                        {
                            title: "100% Respons√°vel",
                            content: `<p style="line-height: 1.8; font-size: 1.1em;">"Voc√™ √© 100% respons√°vel por tudo que aparece em sua realidade" - Dr. Hew Len</p>`
                        },
                        {
                            title: "Mem√≥rias e Realidade",
                            content: `<p style="line-height: 1.8; font-size: 1.1em;">Nossas mem√≥rias subconscientes criam nossa realidade.</p>`
                        }
                    ]
                },
                3: {
                    title: "M√≥dulo 3: Conectando com o Divino",
                    description: "Os tr√™s selves",
                    pages: [
                        {
                            title: "Os Tr√™s Selves",
                            content: `<div style="text-align: center;"><h3 style="color: #a78bfa;">Unihipili - Crian√ßa Interior</h3><p>Guarda todas as mem√≥rias</p></div>`
                        }
                    ]
                }
            };

            // Carregar dados salvos ou usar padr√£o (COM AWAIT PARA FIREBASE)
            modules = await StorageManager.load(StorageManager.KEYS.MODULES, modulosPadrao);
            audiosPersonalizados = await StorageManager.load(StorageManager.KEYS.AUDIOS, []);
            diaryEntries = await StorageManager.load(StorageManager.KEYS.DIARY, []);
        }

        // ===== SISTEMA DE ACESSO ADMIN =====
        function contarCliquesSecretos() {
            const agora = Date.now();
            
            if (agora - tempoUltimoClique > 3000) {
                cliquesSecretos = 0;
            }
            
            cliquesSecretos++;
            tempoUltimoClique = agora;
            
            const logo = document.getElementById('logoSecret');
            if (logo) {
                logo.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    logo.style.transform = 'scale(1)';
                }, 150);
            }
            
            if (cliquesSecretos >= 5) {
                const botaoAdmin = document.getElementById('botaoAdminSecreto');
                if (botaoAdmin) {
                    botaoAdmin.style.display = 'block';
                    botaoAdmin.style.opacity = '0';
                    botaoAdmin.style.transform = 'scale(0.5)';
                    botaoAdmin.style.transition = 'all 0.5s ease';
                    
                    setTimeout(() => {
                        botaoAdmin.style.opacity = '1';
                        botaoAdmin.style.transform = 'scale(1)';
                    }, 100);
                    
                    ToastManager.success('üîê Acesso Admin Desbloqueado!');
                }
                
                cliquesSecretos = 0;
            }
        }

        // ===== FUN√á√ÉO PRINCIPAL DE LOGIN =====
        async function entrarApp() {
            const nome = document.getElementById('name').value.trim();
            
            if (!nome) {
                alert('Por favor, digite seu nome antes de continuar! üìù');
                return;
            }
            
            userName = nome;
            
            // Salvar usu√°rio (s√≥ local)
            StorageManager.saveLocal(StorageManager.KEYS.USER, { nome, lastLogin: new Date().toISOString() });
            
            // Atualizar interface
            const welcomeElement = document.getElementById('welcome');
            const splashElement = document.getElementById('splash');
            const mainElement = document.getElementById('main');
            
            if (welcomeElement) {
                welcomeElement.textContent = `Bem-vindo, ${nome}`;
            }
            
            if (splashElement && mainElement) {
                splashElement.style.display = 'none';
                mainElement.style.display = 'block';
            }
            
            // Carregar dados na interface
            await carregarModulosNaInterface();
            await carregarAudiosNaInterface();
            atualizarDiario();
            
            // Iniciar verifica√ß√£o de atualiza√ß√µes para alunos
            iniciarVerificacaoAtualizacoes();
            
            ToastManager.success(`Bem-vindo, ${nome}! üå∫`);
        }

        // ===== VERIFICA√á√ÉO DE ATUALIZA√á√ïES EM TEMPO REAL =====
        function iniciarVerificacaoAtualizacoes() {
            if (!isAdmin) {
                setInterval(async () => {
                    try {
                        const modulosAtualizados = await StorageManager.load(StorageManager.KEYS.MODULES);
                        const audiosAtualizados = await StorageManager.load(StorageManager.KEYS.AUDIOS);
                        
                        // Verificar se h√° diferen√ßas
                        if (JSON.stringify(modules) !== JSON.stringify(modulosAtualizados)) {
                            modules = modulosAtualizados;
                            carregarModulosNaInterface();
                            ToastManager.success('üì• Novos conte√∫dos dispon√≠veis!');
                        }
                        
                        if (JSON.stringify(audiosPersonalizados) !== JSON.stringify(audiosAtualizados)) {
                            audiosPersonalizados = audiosAtualizados;
                            carregarAudiosNaInterface();
                            ToastManager.success('üéµ Novos √°udios dispon√≠veis!');
                        }
                    } catch (error) {
                        // Erro silencioso
                    }
                }, 30000); // 30 segundos
            }
        }

        // ===== CARREGAR M√ìDULOS NA INTERFACE =====
        async function carregarModulosNaInterface() {
            const container = document.getElementById('modulesContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            Object.entries(modules).forEach(([id, module]) => {
                const card = document.createElement('div');
                card.className = 'module-card';
                card.onclick = () => abrirModulo(parseInt(id));
                
                card.innerHTML = `
                    <div class="module-number">${id}</div>
                    <h3 style="color: #e9d5ff; margin-bottom: 10px; font-size: clamp(1.1em, 4vw, 1.3em);">${module.title}</h3>
                    <p style="color: #c4b5fd; font-size: clamp(0.9em, 3vw, 1em);">${module.description}</p>
                    <p style="color: #86efac; margin-top: 10px; font-size: clamp(0.8em, 2.5vw, 0.9em);">‚ú® ${module.pages.length} p√°gina${module.pages.length !== 1 ? 's' : ''}</p>
                `;
                
                container.appendChild(card);
            });
        }

        // ===== CARREGAR √ÅUDIOS NA INTERFACE =====
        async function carregarAudiosNaInterface() {
            const audioGrid = document.getElementById('audioGrid');
            const mensagem = document.getElementById('mensagemSemAudios');
            
            if (!audioGrid || !mensagem) return;
            
            if (audiosPersonalizados.length === 0) {
                mensagem.style.display = 'block';
                const audiosAntigos = audioGrid.querySelectorAll('[id^="audio-container-"]');
                audiosAntigos.forEach(audio => audio.remove());
            } else {
                mensagem.style.display = 'none';
                const audiosAntigos = audioGrid.querySelectorAll('[id^="audio-container-"]');
                audiosAntigos.forEach(audio => audio.remove());
                
                audiosPersonalizados.forEach(audioData => {
                    criarElementoAudio(audioData);
                });
            }
        }

        // ===== FUN√á√ïES ADMIN =====
        function abrirLoginAdmin() {
            const loginModal = document.getElementById('loginAdmin');
            if (loginModal) {
                loginModal.style.display = 'flex';
            }
        }

        function fecharLoginAdmin() {
            const loginModal = document.getElementById('loginAdmin');
            if (loginModal) {
                loginModal.style.display = 'none';
                document.getElementById('adminUser').value = '';
                document.getElementById('adminPass').value = '';
            }
        }

        function fazerLoginAdmin() {
            const user = document.getElementById('adminUser').value.trim();
            const pass = document.getElementById('adminPass').value.trim();
            
            if (user === ADMIN_USERNAME && pass === ADMIN_PASSWORD) {
                isAdmin = true;
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('userLevel').textContent = 'N√≠vel: Administrador';
                fecharLoginAdmin();
                
                if (document.getElementById('main').style.display === 'none' || !document.getElementById('main').style.display) {
                    userName = user;
                    document.getElementById('welcome').textContent = `Bem-vindo, ${user}`;
                    document.getElementById('splash').style.display = 'none';
                    document.getElementById('main').style.display = 'block';
                    carregarModulosNaInterface();
                    carregarAudiosNaInterface();
                    atualizarDiario();
                }
                
                ToastManager.success('Login admin realizado com sucesso! üîê');
            } else {
                ToastManager.error('Credenciais inv√°lidas! ‚ùå');
            }
        }

        function logoutAdminSimples() {
            // Parar qualquer √°udio tocando
            if (audioAtualTocando) {
                try {
                    if (audioAtualTocando.pause) audioAtualTocando.pause();
                    if (audioAtualTocando.source && audioAtualTocando.source.stop) audioAtualTocando.source.stop();
                } catch (e) {}
                audioAtualTocando = null;
            }
            
            // Resetar vari√°veis
            isAdmin = false;
            userName = '';
            
            // Voltar para tela inicial
            document.getElementById('main').style.display = 'none';
            document.getElementById('splash').style.display = 'flex';
            
            // Limpar campos
            document.getElementById('name').value = '';
            document.getElementById('welcome').textContent = 'Bem-vindo';
            document.getElementById('userLevel').textContent = 'N√≠vel: Iniciante';
            
            // Esconder pain√©is admin
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('painelAdmin').style.display = 'none';
            document.getElementById('botaoAdminSecreto').style.display = 'none';
            
            // Recarregar √°udios sem bot√µes de excluir
            carregarAudiosNaInterface();
            
            ToastManager.success('Logout admin realizado! üë§');
        }

        function abrirPainelAdmin() {
            if (isAdmin) {
                document.getElementById('painelAdmin').style.display = 'block';
                carregarSeletorModulos();
                atualizarEstatisticas();
            } else {
                ToastManager.error('Acesso negado! Fa√ßa login como admin primeiro.');
            }
        }

        function fecharPainelAdmin() {
            document.getElementById('painelAdmin').style.display = 'none';
        }

        function carregarSeletorModulos() {
            const seletor = document.getElementById('seletorModulo');
            if (!seletor) return;
            
            seletor.innerHTML = '<option value="">Selecione um m√≥dulo para editar</option>';
            
            Object.entries(modules).forEach(([id, module]) => {
                const option = document.createElement('option');
                option.value = id;
                option.textContent = module.title;
                seletor.appendChild(option);
            });
        }

        function atualizarEstatisticas() {
            const statModulos = document.getElementById('statModulos');
            const statPaginas = document.getElementById('statPaginas');
            const statAudios = document.getElementById('statAudios');
            
            if (statModulos) statModulos.textContent = Object.keys(modules).length;
            
            if (statPaginas) {
                let totalPaginas = 0;
                Object.values(modules).forEach(mod => {
                    totalPaginas += mod.pages.length;
                });
                statPaginas.textContent = totalPaginas;
            }
            
            if (statAudios) statAudios.textContent = audiosPersonalizados.length;
        }
// ===== SISTEMA DE √ÅUDIOS =====
        function adicionarAudio() {
            if (!isAdmin) {
                ToastManager.error('Apenas administradores podem adicionar √°udios!');
                return;
            }
            
            const arquivo = document.getElementById('uploadAudio').files[0];
            const nome = document.getElementById('nomeAudio').value.trim();
            const descricao = document.getElementById('descricaoAudio').value.trim() || '√Åudio de Ho\'oponopono';
            
            if (!arquivo || !nome) {
                ToastManager.error('Selecione um arquivo e digite o nome!');
                return;
            }
            
            if (!arquivo.type.startsWith('audio/') && !arquivo.name.match(/\.(mp3|wav|ogg|m4a|aac)$/i)) {
                ToastManager.error('Por favor, selecione um arquivo de √°udio v√°lido!');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    const audioData = {
                        id: Date.now(),
                        nome: nome,
                        descricao: descricao,
                        arquivo: e.target.result,
                        tamanho: Math.round(arquivo.size / 1024),
                        tipo: arquivo.type || 'audio/mpeg',
                        nomeArquivo: arquivo.name
                    };
                    
                    audiosPersonalizados.push(audioData);
                    await StorageManager.save(StorageManager.KEYS.AUDIOS, audiosPersonalizados);
                    
                    criarElementoAudio(audioData);
                    
                    const mensagem = document.getElementById('mensagemSemAudios');
                    if (mensagem) {
                        mensagem.style.display = 'none';
                    }
                    
                    document.getElementById('uploadAudio').value = '';
                    document.getElementById('nomeAudio').value = '';
                    document.getElementById('descricaoAudio').value = '';
                    
                    atualizarEstatisticas();
                    ToastManager.success('‚úÖ √Åudio adicionado e sincronizado na nuvem!');
                    
                } catch (error) {
                    ToastManager.error('‚ùå Erro ao processar arquivo');
                }
            };
            
            reader.readAsDataURL(arquivo);
        }

        function criarElementoAudio(audioData) {
            const audioGrid = document.querySelector('#audioContent .modules-grid');
            if (!audioGrid) return;
            
            const novoAudio = document.createElement('div');
            novoAudio.className = 'audio-card';
            novoAudio.style.cssText = 'background: rgba(30, 0, 60, 0.3); backdrop-filter: blur(10px); border-radius: 20px; padding: clamp(15px, 4vw, 20px); border: 1px solid rgba(139, 92, 246, 0.3); position: relative; min-height: 200px;';
            novoAudio.id = `audio-container-${audioData.id}`;
            
            novoAudio.innerHTML = `
                <div class="audio-play-btn" style="width: clamp(50px, 12vw, 60px); height: clamp(50px, 12vw, 60px); background: linear-gradient(135deg, #8b5cf6, #10b981); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: clamp(24px, 6vw, 30px); margin-bottom: 15px; cursor: pointer; transition: all 0.3s ease;" 
                     onclick="reproduzirAudio(${audioData.id})">‚ñ∂</div>
                
                <h3 style="color: #e9d5ff; margin-bottom: 10px; font-size: clamp(1.1em, 4vw, 1.3em);">${audioData.nome}</h3>
                <p style="color: #c4b5fd; font-size: clamp(0.9em, 3vw, 1em);">${audioData.descricao} ‚Ä¢ ${audioData.tamanho}KB</p>
                <p style="color: #86efac; font-size: clamp(0.7em, 2.5vw, 0.8em);">Formato: ${audioData.tipo.split('/')[1]?.toUpperCase() || 'MP3'}</p>
            `;
            
            audioGrid.appendChild(novoAudio);
            
            if (isAdmin) {
                const btnExcluir = document.createElement('button');
                btnExcluir.innerHTML = 'üóëÔ∏è Excluir';
                btnExcluir.style.cssText = 'position: absolute; top: 10px; right: 10px; background: #ef4444; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 13px; font-weight: bold; z-index: 10; min-height: 32px;';
                btnExcluir.onclick = () => excluirAudioCompleto(audioData.id);
                novoAudio.appendChild(btnExcluir);
            }
        }

        function reproduzirAudio(audioId) {
            const audioData = audiosPersonalizados.find(a => a.id === audioId);
            if (!audioData) {
                ToastManager.error('√Åudio n√£o encontrado!');
                return;
            }
            
            try {
                const audio = new Audio();
                audio.src = audioData.arquivo;
                audioAtualTocando = audio;
                audio.play();
                ToastManager.success('üéµ Reproduzindo √°udio...');
            } catch (error) {
                ToastManager.error('‚ùå Erro ao reproduzir √°udio');
            }
        }

        async function excluirAudioCompleto(audioId) {
            if (!confirm('Tem certeza que deseja excluir este √°udio?')) return;
            
            try {
                const container = document.getElementById(`audio-container-${audioId}`);
                if (container) container.remove();
                
                const index = audiosPersonalizados.findIndex(audio => audio.id == audioId);
                if (index !== -1) audiosPersonalizados.splice(index, 1);
                
                await StorageManager.save(StorageManager.KEYS.AUDIOS, audiosPersonalizados);
                
                if (audiosPersonalizados.length === 0) {
                    const mensagem = document.getElementById('mensagemSemAudios');
                    if (mensagem) mensagem.style.display = 'block';
                }
                
                atualizarEstatisticas();
                ToastManager.success('√Åudio exclu√≠do com sucesso! üóëÔ∏è');
                
            } catch (error) {
                ToastManager.error('Erro ao excluir √°udio');
            }
        }

        // ===== NAVEGA√á√ÉO =====
        function irPara(secao) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            
            event.target.closest('.nav-item').classList.add('active');
            const contentElement = document.getElementById(secao + 'Content');
            if (contentElement) {
                contentElement.classList.add('active');
            }
        }

        // ===== M√ìDULOS E LEITOR =====
        function abrirModulo(num) {
            const module = modules[num];
            if (!module) {
                ToastManager.error('M√≥dulo em desenvolvimento! üöß');
                return;
            }
            
            currentPage = 1;
            totalPages = module.pages.length;
            
            document.getElementById('bookTitle').textContent = module.title;
            
            const container = document.getElementById('flipbook');
            container.innerHTML = '';
            
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                module.pages.forEach((page, index) => {
                    const spreadDiv = document.createElement('div');
                    spreadDiv.className = `page-spread ${index === 0 ? 'current' : 'hidden'}`;
                    spreadDiv.id = `spread${index + 1}`;
                    
                    spreadDiv.innerHTML = `
                        <div class="page-left">
                            <div class="page-content">
                                <h2>${page.title}</h2>
                                ${page.content}
                                <div class="page-number">${index + 1}</div>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(spreadDiv);
                });
                totalPages = module.pages.length;
            } else {
                totalPages = Math.ceil(module.pages.length / 2);
                
                for (let i = 0; i < module.pages.length; i += 2) {
                    const spreadDiv = document.createElement('div');
                    spreadDiv.className = `page-spread ${i === 0 ? 'current' : 'hidden'}`;
                    spreadDiv.id = `spread${Math.floor(i / 2) + 1}`;
                    
                    const leftPage = module.pages[i];
                    const rightPage = module.pages[i + 1];
                    
                    let leftContent = '';
                    let rightContent = '';
                    
                    if (leftPage) {
                        leftContent = `
                            <div class="page-left">
                                <div class="page-content">
                                    <h2>${leftPage.title}</h2>
                                    ${leftPage.content}
                                    <div class="page-number">${i + 1}</div>
                                </div>
                            </div>
                        `;
                    }
                    
                    if (rightPage) {
                        rightContent = `
                            <div class="page-right">
                                <div class="page-content">
                                    <h2>${rightPage.title}</h2>
                                    ${rightPage.content}
                                    <div class="page-number">${i + 2}</div>
                                </div>
                            </div>
                        `;
                    } else {
                        rightContent = `
                            <div class="page-right">
                                <div class="page-content">
                                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">
                                        <p style="text-align: center; font-style: italic;">Fim do m√≥dulo</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    spreadDiv.innerHTML = leftContent + rightContent;
                    container.appendChild(spreadDiv);
                }
            }
            
            document.getElementById('book').style.display = 'block';
            atualizarPagina();
        }

        function paginaAnterior() {
            if (currentPage > 1) {
                tocarSomPagina();
                
                const paginaAtual = document.getElementById(`spread${currentPage}`);
                if (paginaAtual) {
                    paginaAtual.className = 'page-spread hidden';
                }
                
                currentPage--;
                
                const paginaAnterior = document.getElementById(`spread${currentPage}`);
                if (paginaAnterior) {
                    paginaAnterior.className = 'page-spread current';
                }
                
                atualizarPagina();
            }
        }

        function proximaPagina() {
            if (currentPage < totalPages) {
                tocarSomPagina();
                
                const paginaAtual = document.getElementById(`spread${currentPage}`);
                if (paginaAtual) {
                    paginaAtual.className = 'page-spread hidden';
                }
                
                currentPage++;
                
                const proximaPagina = document.getElementById(`spread${currentPage}`);
                if (proximaPagina) {
                    proximaPagina.className = 'page-spread current';
                }
                
                atualizarPagina();
            }
        }

        function fecharLivro() {
            document.getElementById('book').style.display = 'none';
        }

        function atualizarPagina() {
            document.getElementById('pageInfo').textContent = `P√°gina ${currentPage} de ${totalPages}`;
            
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            if (prevBtn) {
                prevBtn.disabled = currentPage === 1;
                prevBtn.style.opacity = currentPage === 1 ? '0.3' : '1';
            }
            
            if (nextBtn) {
                nextBtn.disabled = currentPage === totalPages;
                nextBtn.style.opacity = currentPage === totalPages ? '0.3' : '1';
            }
        }

        // ===== DI√ÅRIO =====
        function salvarDiario() {
            const texto = document.getElementById('diaryText').value.trim();
            if (!texto) {
                ToastManager.error('Por favor, escreva algo antes de salvar! üìù');
                return;
            }
            
            diaryEntries.unshift({
                date: new Date().toLocaleString('pt-BR'),
                text: texto
            });
            
            StorageManager.save(StorageManager.KEYS.DIARY, diaryEntries);
            
            document.getElementById('diaryText').value = '';
            atualizarDiario();
            ToastManager.success('Entrada salva com sucesso! üå∫');
        }

        function atualizarDiario() {
            const container = document.getElementById('entradas');
            if (!container) return;
            
            if (diaryEntries.length === 0) {
                container.innerHTML = '<p style="color: #c4b5fd; text-align: center; font-size: clamp(1em, 3vw, 1.1em);">Suas entradas aparecer√£o aqui</p>';
            } else {
                container.innerHTML = diaryEntries.map(entry => `
                    <div style="margin-bottom: 15px; padding: clamp(12px, 3vw, 15px); background: rgba(0, 0, 0, 0.2); border-radius: 10px;">
                        <div style="color: #a78bfa; font-size: clamp(0.8em, 2.5vw, 0.9em); margin-bottom: 5px;">${entry.date}</div>
                        <p style="line-height: 1.6; font-size: clamp(1em, 3vw, 1.1em);">${entry.text}</p>
                    </div>
                `).join('');
            }
        }

        // ===== COMUNIDADE =====
        function publicarPost() {
            const texto = document.getElementById('postText').value.trim();
            if (!texto && !selectedImage) {
                ToastManager.error('Por favor, escreva algo ou adicione uma imagem antes de publicar! üí¨');
                return;
            }
            
            postId++;
            const container = document.getElementById('posts');
            
            let imagemHtml = '';
            if (selectedImage) {
                imagemHtml = `<div style="margin: 15px 0;"><img src="${selectedImage}" style="max-width: 100%; max-height: 400px; border-radius: 10px; border: 1px solid rgba(139, 92, 246, 0.3);"></div>`;
            }
            
            const postHtml = `
                <div style="background: rgba(30, 0, 60, 0.3); backdrop-filter: blur(10px); border-radius: 20px; padding: clamp(15px, 4vw, 20px); border: 1px solid rgba(139, 92, 246, 0.3); margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div style="width: clamp(35px, 8vw, 40px); height: clamp(35px, 8vw, 40px); background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: clamp(1em, 4vw, 1.2em);">${userName.charAt(0).toUpperCase()}</div>
                        <div style="flex: 1; min-width: 0;">
                            <div style="font-weight: bold; font-size: clamp(1em, 3.5vw, 1.1em);">${userName}</div>
                            <div style="color: #c4b5fd; font-size: clamp(0.8em, 2.5vw, 0.9em);">agora mesmo</div>
                        </div>
                        <button style="background: #ef4444; color: white; border: none; padding: clamp(4px, 1vw, 6px) clamp(8px, 2vw, 12px); border-radius: 5px; cursor: pointer; font-size: clamp(0.7em, 2vw, 0.8em); min-height: 32px;" onclick="this.parentElement.parentElement.remove(); ToastManager.success('Post exclu√≠do!')">üóëÔ∏è Excluir</button>
                    </div>
                    <p style="line-height: 1.6; margin-bottom: 15px; font-size: clamp(1em, 3vw, 1.1em);">${texto}</p>
                    ${imagemHtml}
                    
                    <div style="border-top: 1px solid rgba(139, 92, 246, 0.2); padding-top: 15px;">
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="text" placeholder="Adicione um coment√°rio..." style="flex: 1; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 15px; padding: clamp(6px, 2vw, 8px) clamp(12px, 3vw, 15px); color: white; font-size: clamp(0.8em, 2.5vw, 0.9em);" onkeypress="if(event.key==='Enter') comentar(this, '${postId}')">
                            <button style="background: #8b5cf6; color: white; border: none; padding: clamp(6px, 2vw, 8px) clamp(12px, 3vw, 15px); border-radius: 15px; cursor: pointer; font-size: clamp(0.8em, 2.5vw, 0.9em); min-height: 40px;" onclick="comentar(this.previousElementSibling, '${postId}')">üí¨</button>
                        </div>
                        <div id="comentarios-${postId}"></div>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('afterbegin', postHtml);
            document.getElementById('postText').value = '';
            removerImagem();
            ToastManager.success('Post publicado com sucesso! üéâ');
        }

        function mostrarPreview(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    selectedImage = e.target.result;
                    document.getElementById('previewImg').src = selectedImage;
                    document.getElementById('imagePreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                ToastManager.error('Por favor, selecione um arquivo de imagem v√°lido! üñºÔ∏è');
            }
        }

        function removerImagem() {
            selectedImage = null;
            document.getElementById('imageUpload').value = '';
            document.getElementById('imagePreview').style.display = 'none';
        }

        function comentar(input, postId) {
            const texto = input.value.trim();
            if (!texto) {
                ToastManager.error('Digite um coment√°rio antes de enviar! üí≠');
                return;
            }
            
            const comentariosDiv = document.getElementById('comentarios-' + postId);
            
            const comentarioHtml = `
                <div style="background: rgba(0, 0, 0, 0.2); border-radius: 10px; padding: clamp(8px, 2vw, 10px); margin-bottom: 8px; border-left: 3px solid #8b5cf6;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 5px; gap: 10px;">
                        <div style="display: flex; align-items: center; gap: 8px; flex: 1; min-width: 0;">
                            <div style="width: clamp(20px, 5vw, 25px); height: clamp(20px, 5vw, 25px); background: #10b981; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: clamp(0.7em, 2vw, 0.8em); flex-shrink: 0;">${userName.charAt(0).toUpperCase()}</div>
                            <span style="font-weight: bold; font-size: clamp(0.8em, 2.5vw, 0.9em);">${userName}</span>
                            <span style="color: #c4b5fd; font-size: clamp(0.7em, 2vw, 0.8em);">agora</span>
                        </div>
                        <button style="background: #ef4444; color: white; border: none; padding: clamp(2px, 0.5vw, 3px) clamp(4px, 1vw, 7px); border-radius: 3px; cursor: pointer; font-size: clamp(0.6em, 1.5vw, 0.7em); min-height: 24px; flex-shrink: 0;" onclick="this.parentElement.parentElement.remove(); ToastManager.success('Coment√°rio exclu√≠do!')">üóëÔ∏è</button>
                    </div>
                    <p style="font-size: clamp(0.8em, 2.5vw, 0.9em); line-height: 1.4; margin-left: clamp(28px, 7vw, 33px);">${texto}</p>
                </div>
            `;
            
            comentariosDiv.insertAdjacentHTML('beforeend', comentarioHtml);
            input.value = '';
        }

        // ===== INICIALIZA√á√ÉO =====
        document.addEventListener('DOMContentLoaded', async function() {
            // Inicializar dados
            await inicializarDadosPadrao();
            
            // Verificar usu√°rio salvo
            try {
                const usuarioSalvo = StorageManager.loadLocal(StorageManager.KEYS.USER);
                if (usuarioSalvo && usuarioSalvo.nome && !isAdmin) {
                    const nameInput = document.getElementById('name');
                    if (nameInput) nameInput.value = usuarioSalvo.nome;
                }
            } catch (e) {}
            
            // Event listeners
            const nameInput = document.getElementById('name');
            if (nameInput) {
                nameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        entrarApp();
                    }
                });
            }
            
            const btnIniciar = document.getElementById('btnIniciarJornada');
            if (btnIniciar) {
                btnIniciar.addEventListener('click', entrarApp);
            }
            
            // Configurar logo para acesso admin
            const logo = document.getElementById('logoSecret');
            if (logo) {
                logo.onclick = contarCliquesSecretos;
            }
        });

        // Gestos touch para mobile
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }, { passive: true });

        document.addEventListener('touchend', function(e) {
            if (!touchStartX || !touchStartY) return;

            let touchEndX = e.changedTouches[0].clientX;
            let touchEndY = e.changedTouches[0].clientY;

            let diffX = touchStartX - touchEndX;
            let diffY = touchStartY - touchEndY;

            if (document.getElementById('book').style.display === 'block') {
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                    if (diffX > 0) {
                        proximaPagina();
                    } else {
                        paginaAnterior();
                    }
                }
            }

            touchStartX = 0;
            touchStartY = 0;
        }, { passive: true });

        // Prevenir F12 e ferramentas de desenvolvedor em produ√ß√£o
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            document.addEventListener('keydown', function(e) {
                if (e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                    (e.ctrlKey && e.shiftKey && e.key === 'J') ||
                    (e.ctrlKey && e.key === 'U')) {
                    e.preventDefault();
                    return false;
                }
            });
            
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
        }
    </script>
</body>
</html>
